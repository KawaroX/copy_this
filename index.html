<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«é€Ÿå¤åˆ¶</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', sans-serif;
            background: #f7f7f5;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: #37352f;
        }
        
        .container {
            background: white;
            border-radius: 8px;
            padding: 48px 40px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05), 0 10px 40px rgba(0, 0, 0, 0.08);
            max-width: 600px;
            width: 100%;
        }
        
        .header {
            margin-bottom: 32px;
        }
        
        .icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
        
        h1 {
            font-size: 24px;
            font-weight: 600;
            color: #37352f;
            margin-bottom: 8px;
        }
        
        .subtitle {
            color: #787774;
            font-size: 14px;
        }
        
        .content-section {
            margin: 24px 0;
        }
        
        /* æ–°å¢ï¼šè¾“å…¥æ¡†æ ·å¼ */
        #textInput {
            width: 100%;
            border: 1px solid #e3e2e0;
            border-radius: 4px;
            padding: 12px;
            font-family: inherit;
            font-size: 14px;
            resize: vertical;
        }

        /* æ–°å¢ï¼šè¾“å…¥é€‰é¡¹æ ·å¼ */
        .options-group {
            margin-top: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .options-group .input-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .options-group .input-group label {
            font-size: 14px;
            white-space: nowrap;
            color: #37352f;
        }

        .options-group .input-group input[type="text"] {
            flex: 1;
            border: 1px solid #e3e2e0;
            border-radius: 4px;
            padding: 6px 10px;
            font-size: 14px;
        }
        
        .label {
            font-size: 12px;
            font-weight: 600;
            color: #787774;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        
        .display-box {
            background: #f7f7f5;
            border: 1px solid #e3e2e0;
            border-radius: 4px;
            padding: 16px;
            font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
            font-size: 18px;
            color: #37352f;
            word-break: break-all;
            line-height: 1.6;
            min-height: 50px;
        }
        
        .parts-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 12px;
        }
        
        .part-item {
            background: #f7f7f5;
            border: 1px solid #e3e2e0;
            border-radius: 4px;
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .part-item:hover {
            background: #f0f0ee;
            border-color: #d3d1cb;
        }
        
        .part-text {
            font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
            font-size: 15px;
            color: #37352f;
            flex: 1;
            word-break: break-all;
        }
        
        .part-label {
            font-size: 11px;
            color: #787774;
            margin-bottom: 4px;
            font-weight: 500;
        }
        
        .copy-indicator {
            color: #787774;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.2s;
            padding-left: 10px;
        }
        
        .part-item:hover .copy-indicator {
            opacity: 1;
        }
        
        .button-group {
            display: flex;
            gap: 8px;
            margin-top: 24px;
        }
        
        .btn {
            flex: 1;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }
        
        .btn-primary {
            background: #37352f;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2e2c28;
        }
        
        .btn-primary:active {
            transform: scale(0.98);
        }
        
        .btn-secondary {
            background: white;
            color: #37352f;
            border: 1px solid #e3e2e0;
        }
        
        .btn-secondary:hover {
            background: #f7f7f5;
        }

        /* æ–°å¢ï¼šç”¨äºè¿”å›æŒ‰é’® */
        .btn-back {
            flex: 0 1 auto; /* ä¸æ‹‰ä¼¸ï¼Œä¿æŒå†…å®¹å®½åº¦ */
            padding: 10px 16px;
        }
        
        .status {
            margin-top: 16px;
            padding: 12px 16px;
            border-radius: 4px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status.show {
            opacity: 1;
        }
        
        .status.success {
            background: #edf3ec;
            color: #0f7b6c;
        }
        
        .status.error {
            background: #fdebec;
            color: #e03e3e;
        }
        
        .info-text {
            color: #9b9a97;
            font-size: 13px;
            margin-top: 20px;
            line-height: 1.5;
        }
        
        .divider {
            height: 1px;
            background: #e3e2e0;
            margin: 24px 0;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 8px 0;
        }
        
        .checkbox-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
        
        .checkbox-item label {
            font-size: 14px;
            cursor: pointer;
            user-select: none;
            color: #37352f;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="icon">ğŸ“‹</div>
            <h1 id="title">å¿«é€Ÿå¤åˆ¶</h1>
            <div class="subtitle" id="subtitle">ç‚¹å‡»å†…å®¹å³å¯å¤åˆ¶åˆ°å‰ªè´´æ¿</div>
        </div>

        <div class="content-section" id="inputSection" style="display: none;">
            <div class="label">è¾“å…¥å†…å®¹</div>
            <textarea id="textInput" rows="5" placeholder="åœ¨æ­¤ç²˜è´´æ‚¨çš„æ–‡æœ¬..."></textarea>
            
            <div class="options-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="autoSplitCheckbox" checked>
                    <label for="autoSplitCheckbox">æ™ºèƒ½æ‹†åˆ†</label>
                </div>
                <div class="input-group">
                    <label for="customSplitInput">è‡ªå®šä¹‰åˆ†éš”ç¬¦:</label>
                    <input type="text" id="customSplitInput" placeholder="ä¾‹å¦‚ï¼š, æˆ– \n (æ¢è¡Œ)">
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" onclick="processInput()">å¤„ç†å†…å®¹</button>
                <button class="btn btn-secondary" onclick="generateLink()">ç”Ÿæˆåˆ†äº«é“¾æ¥</button>
            </div>
        </div>

        <div class="content-section" id="mainContent" style="display: none;">
            <div class="label">å†…å®¹</div>
            <div class="display-box" id="fullContent">-</div>
        </div>

        <div class="content-section" id="partsSection" style="display: none;">
            <div class="label">é€‰æ‹©è¦å¤åˆ¶çš„éƒ¨åˆ†</div>
            <div class="parts-container" id="partsContainer"></div>
            <div class="checkbox-item" style="margin-top: 16px;">
                <input type="checkbox" id="copyAllCheckbox">
                <label for="copyAllCheckbox">ä¸€æ¬¡æ€§å¤åˆ¶æ‰€æœ‰é€‰ä¸­é¡¹</label>
            </div>
        </div>

        <div class="button-group" id="mainActionButtons" style="display: none;">
            <button class="btn btn-primary" onclick="copyContent()">
                <span id="btnText">å¤åˆ¶</span>
            </button>
            <button class="btn btn-secondary" onclick="copyAll()" id="copyAllBtn" style="display: none;">
                å¤åˆ¶å…¨éƒ¨
            </button>
            <button class="btn btn-secondary btn-back" onclick="resetPage()" id="resetBtn">
                è¿”å›
            </button>
        </div>

        <div class="status" id="status"></div>

        <div class="divider"></div>

        <div class="info-text">
            <strong>ä½¿ç”¨æ–¹æ³•ï¼š</strong><br>
            â€¢ åŸºç¡€å¤åˆ¶ï¼š<code>?code=å†…å®¹</code><br>
            â€¢ æ™ºèƒ½æ‹†åˆ†ï¼š<code>?text=å†…å®¹&mode=auto</code><br>
            â€¢ è‡ªå®šä¹‰åˆ†éš”ï¼š<code>?text=å†…å®¹&split=,</code><br>
            â€¢ å¤šä¸ªå€¼ï¼š<code>?values=å€¼1,å€¼2,å€¼3</code>
        </div>
    </div>

    <script>
        let currentMode = 'simple';
        let extractedParts = [];
        let selectedParts = new Set();

        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                code: params.get('code'),
                text: params.get('text'),
                mode: params.get('mode'),
                split: params.get('split'),
                values: params.get('values'),
                title: params.get('title')
            };
        }

        /**
         * ä¼˜åŒ–çš„æ™ºèƒ½æå–å‡½æ•°
         */
        function autoExtractParts(text) {
            const parts = [];
            const seen = new Set(); // ç”¨äºå»é‡

            // è¾…åŠ©å‡½æ•°ï¼Œé¿å…é‡å¤æ·»åŠ 
            const addPart = (label, value, type) => {
                const trimmedValue = value.trim();
                if (trimmedValue && !seen.has(trimmedValue)) {
                    parts.push({ label, value: trimmedValue, type });
                    seen.add(trimmedValue);
                }
            };

            // æå–å™¨å®šä¹‰
            const extractors = [
                // 1. ç½‘å€
                { label: 'ç½‘å€', regex: /(https?:\/\/[^\s"'<>()]+)/gi, group: 1 },
                // 2. ç”µè¯å·ç 
                { label: 'ç”µè¯', regex: /(1[3-9]\d{9})(?!\d)/g, group: 1 },
                // 3. ã€æ ‡ç­¾ã€‘
                { label: 'æ ‡ç­¾', regex: /ã€([^ã€‘]+)ã€‘/g, group: 1 },
                // 4. å–ä»¶ç  (åŒ…æ‹¬å­—æ¯)
                { label: 'å–ä»¶ç ', regex: /(?:å–ä»¶ç |å–è´§ç |éªŒè¯ç |æå–ç |code)\s*[:ï¼š]?\s*([A-Za-z0-9]+)/gi, group: 1 },
                // 5. 4ä½å°¾å·
                { label: 'å°¾å·', regex: /(?:å°¾å·)\s*(\d{4})/g, group: 1 },
                // 6. åœ°å€
                { label: 'åœ°å€', regex: /(?:åœ°å€|address)\s*[:ï¼š]?\s*([^\nï¼Œã€‚]+(?:(?:çœ|å¸‚|åŒº|è·¯|å·|æ¥¼|åº§|å®¤|ä¸­å¿ƒ|æœåŠ¡ç«™)[^\nï¼Œã€‚]*))/gi, group: 1 },
                // 7. 6ä½ä»¥ä¸Šçº¯æ•°å­—ï¼ˆä½œä¸ºå¤‡ç”¨å–ä»¶ç ï¼‰
                { label: 'æ•°å­—', regex: /(\d{6,})/g, group: 1 }
            ];

            for (const extractor of extractors) {
                let match;
                while ((match = extractor.regex.exec(text)) !== null) {
                    if (match[extractor.group]) {
                        addPart(extractor.label, match[extractor.group], extractor.label.toLowerCase());
                    }
                }
            }
            
            return parts;
        }

        function renderParts(parts) {
            const container = document.getElementById('partsContainer');
            container.innerHTML = '';
            
            parts.forEach((part, index) => {
                const div = document.createElement('div');
                div.className = 'part-item';
                div.onclick = () => togglePart(index, part.value);
                
                div.innerHTML = `
                    <div style="flex: 1;">
                        <div class="part-label">${part.label}</div>
                        <div class="part-text">${part.value}</div>
                    </div>
                    <div class="copy-indicator">ç‚¹å‡»å¤åˆ¶</div>
                `;
                
                container.appendChild(div);
            });
        }

        function togglePart(index, value) {
            const checkbox = document.getElementById('copyAllCheckbox');
            
            if (checkbox.checked) {
                if (selectedParts.has(index)) {
                    selectedParts.delete(index);
                } else {
                    selectedParts.add(index);
                }
                updatePartSelection();
            } else {
                copyToClipboard(value, `å·²å¤åˆ¶ï¼š${value}`);
            }
        }

        function updatePartSelection() {
            const items = document.querySelectorAll('.part-item');
            items.forEach((item, index) => {
                if (selectedParts.has(index)) {
                    item.style.background = '#e3f2fd';
                    item.style.borderColor = '#90caf9';
                } else {
                    item.style.background = '#f7f7f5';
                    item.style.borderColor = '#e3e2e0';
                }
            });
        }

        function showStatus(message, isSuccess) {
            const status = document.getElementById('status');
            status.innerHTML = `<span>${isSuccess ? 'âœ“' : 'âœ•'}</span> ${message}`;
            status.className = 'status show ' + (isSuccess ? 'success' : 'error');
            
            setTimeout(() => {
                status.classList.remove('show');
            }, 3000);
        }

        async function copyToClipboard(text, successMsg) {
            try {
                await navigator.clipboard.writeText(text);
                showStatus(successMsg || 'å¤åˆ¶æˆåŠŸï¼', true);
            } catch (err) {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                document.body.appendChild(textArea);
                textArea.select();
                
                try {
                    document.execCommand('copy');
                    showStatus(successMsg || 'å¤åˆ¶æˆåŠŸï¼', true);
                } catch (err2) {
                    showStatus('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', false);
                }
                
                document.body.removeChild(textArea);
            }
        }

        function copyContent() {
            const checkbox = document.getElementById('copyAllCheckbox');
            
            if (currentMode === 'parts' && checkbox.checked && selectedParts.size > 0) {
                const selected = extractedParts
                    .filter((_, index) => selectedParts.has(index))
                    .map(p => p.value)
                    .join('\n');
                copyToClipboard(selected, `å·²å¤åˆ¶ ${selectedParts.size} é¡¹å†…å®¹`);
            } else if (currentMode === 'simple') {
                const content = document.getElementById('fullContent').textContent;
                copyToClipboard(content, 'å·²å¤åˆ¶');
            } else if (currentMode === 'parts' && (!checkbox.checked || selectedParts.size === 0)) {
                 showStatus('è¯·ç‚¹å‡»è¦å¤åˆ¶çš„å†…å®¹ï¼Œæˆ–å‹¾é€‰â€œä¸€æ¬¡æ€§å¤åˆ¶â€å¹¶é€‰æ‹©', false);
            } else {
                const content = document.getElementById('fullContent').textContent;
                copyToClipboard(content, 'å·²å¤åˆ¶');
            }
        }

        function copyAll() {
            const content = document.getElementById('fullContent').textContent;
            copyToClipboard(content, 'å·²å¤åˆ¶å®Œæ•´å†…å®¹');
        }

        /**
         * æ–°å¢ï¼šå¤„ç†æ¥è‡ªè¾“å…¥æ¡†çš„å†…å®¹
         */
        function processInput() {
            const text = document.getElementById('textInput').value.trim();
            if (!text) {
                showStatus('è¯·è¾“å…¥å†…å®¹', false);
                return;
            }

            const customSplit = document.getElementById('customSplitInput').value;
            const autoSplit = document.getElementById('autoSplitCheckbox').checked;

            // éšè—è¾“å…¥åŒºï¼Œæ˜¾ç¤ºå†…å®¹åŒº
            document.getElementById('inputSection').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            document.getElementById('mainActionButtons').style.display = 'flex';

            document.getElementById('fullContent').textContent = text;
            extractedParts = [];
            selectedParts.clear();
            
            let parts = [];
            
            if (customSplit) {
                // è‡ªå®šä¹‰åˆ†éš”
                currentMode = 'parts';
                // å…è®¸ \n ä½œä¸ºæ¢è¡Œç¬¦
                const separator = customSplit.replace(/\\n/g, '\n');
                parts = text.split(separator).map(v => v.trim()).filter(v => v);
                extractedParts = parts.map((v, i) => ({ 
                    label: `éƒ¨åˆ† ${i + 1}`, 
                    value: v,
                    type: 'part'
                }));
            } else if (autoSplit) {
                // æ™ºèƒ½æ‹†åˆ†
                currentMode = 'parts';
                extractedParts = autoExtractParts(text);
            } else {
                // ç®€å•æ¨¡å¼
                currentMode = 'simple';
            }
            
            if (extractedParts.length > 0) {
                renderParts(extractedParts);
                document.getElementById('partsSection').style.display = 'block';
                document.getElementById('copyAllBtn').style.display = 'block';
                document.getElementById('btnText').textContent = 'å¤åˆ¶é€‰ä¸­';
            } else {
                document.getElementById('partsSection').style.display = 'none';
                document.getElementById('copyAllBtn').style.display = 'none';
                document.getElementById('btnText').textContent = 'å¤åˆ¶';
            }
        }

        /**
         * æ–°å¢ï¼šç”Ÿæˆåˆ†äº«é“¾æ¥
         */
        function generateLink() {
            const text = document.getElementById('textInput').value.trim();
            if (!text) {
                showStatus('è¯·è¾“å…¥å†…å®¹ä»¥ç”Ÿæˆé“¾æ¥', false);
                return;
            }
            
            const customSplit = document.getElementById('customSplitInput').value;
            const autoSplit = document.getElementById('autoSplitCheckbox').checked;
            
            const baseUrl = window.location.origin + window.location.pathname;
            let params = new URLSearchParams();
            
            params.set('text', text);
            
            if (customSplit) {
                params.set('split', customSplit);
            } else if (autoSplit) {
                params.set('mode', 'auto');
            }
            
            const url = `${baseUrl}?${params.toString()}`;
            copyToClipboard(url, 'åˆ†äº«é“¾æ¥å·²å¤åˆ¶ï¼');
        }

        /**
         * æ–°å¢ï¼šè¿”å›è¾“å…¥ç•Œé¢
         */
        function resetPage() {
            // ä½¿ç”¨ pathname é‡ç½®é¡µé¢ï¼Œæ¸…é™¤æ‰€æœ‰URLå‚æ•°
            window.location.href = window.location.pathname;
        }

        /**
         * æ–°å¢ï¼šæ ¹æ®å‚æ•°è®¾ç½®é¡µé¢
         */
        function setupFromParams(params) {
            // æ˜¾ç¤ºä¸»å†…å®¹åŒºå’ŒæŒ‰é’®
            document.getElementById('mainContent').style.display = 'block';
            document.getElementById('mainActionButtons').style.display = 'flex';

            // è®¾ç½®æ ‡é¢˜
            if (params.title) {
                document.getElementById('title').textContent = decodeURIComponent(params.title);
            }
            
            // ç®€å•æ¨¡å¼ï¼šç›´æ¥å¤åˆ¶ code
            if (params.code) {
                currentMode = 'simple';
                const code = decodeURIComponent(params.code);
                document.getElementById('fullContent').textContent = code;
                document.getElementById('subtitle').textContent = 'å†…å®¹å·²è‡ªåŠ¨å¤åˆ¶åˆ°å‰ªè´´æ¿';
                copyToClipboard(code, 'å·²è‡ªåŠ¨å¤åˆ¶å†…å®¹');
                return;
            }
            
            // å¤šå€¼æ¨¡å¼
            if (params.values) {
                currentMode = 'parts';
                const values = decodeURIComponent(params.values).split(',').map(v => v.trim());
                document.getElementById('fullContent').textContent = values.join('\n');
                extractedParts = values.map((v, i) => ({ 
                    label: `é¡¹ç›® ${i + 1}`, 
                    value: v,
                    type: 'item'
                }));
                renderParts(extractedParts);
                document.getElementById('partsSection').style.display = 'block';
                document.getElementById('copyAllBtn').style.display = 'block';
                document.getElementById('btnText').textContent = 'å¤åˆ¶é€‰ä¸­';
                return;
            }
            
            // æ–‡æœ¬å¤„ç†æ¨¡å¼
            if (params.text) {
                const text = decodeURIComponent(params.text);
                document.getElementById('fullContent').textContent = text;
                
                // è‡ªåŠ¨è¯†åˆ«æ¨¡å¼
                if (params.mode === 'auto') {
                    currentMode = 'parts';
                    extractedParts = autoExtractParts(text);
                    
                    if (extractedParts.length > 0) {
                        renderParts(extractedParts);
                        document.getElementById('partsSection').style.display = 'block';
                        document.getElementById('copyAllBtn').style.display = 'block';
                        document.getElementById('btnText').textContent = 'å¤åˆ¶é€‰ä¸­';
                    }
                }
                
                // è‡ªå®šä¹‰åˆ†éš”ç¬¦
                else if (params.split) {
                    currentMode = 'parts';
                    const separator = decodeURIComponent(params.split).replace(/\\n/g, '\n');
                    const parts = text.split(separator).map(v => v.trim()).filter(v => v);
                    extractedParts = parts.map((v, i) => ({ 
                        label: `éƒ¨åˆ† ${i + 1}`, 
                        value: v,
                        type: 'part'
                    }));
                    renderParts(extractedParts);
                    document.getElementById('partsSection').style.display = 'block';
                    document.getElementById('copyAllBtn').style.display = 'block';
                    document.getElementById('btnText').textContent = 'å¤åˆ¶é€‰ä¸­';
                }
                
                // é»˜è®¤ç®€å•æ¨¡å¼
                else {
                    currentMode = 'simple';
                }
                return;
            }
        }
        
        /**
         * æ–°å¢ï¼šè®¾ç½®è¾“å…¥æ¨¡å¼
         */
        function setupInputMode() {
            document.getElementById('inputSection').style.display = 'block';
            document.getElementById('subtitle').textContent = 'ç²˜è´´å†…å®¹æˆ–ä½¿ç”¨URLå‚æ•°';
            // ç¡®ä¿å…¶ä»–éƒ¨åˆ†éšè—
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('partsSection').style.display = 'none';
            document.getElementById('mainActionButtons').style.display = 'none';
        }

        function init() {
            const params = getUrlParams();
            
            // æ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½•æœ‰æ•ˆå‚æ•°
            if (params.code || params.text || params.values) {
                setupFromParams(params);
            } else {
                // æ²¡æœ‰å‚æ•°ï¼Œè¿›å…¥è¾“å…¥æ¨¡å¼
                setupInputMode();
            }
        }

        window.addEventListener('load', init);
        
        document.getElementById('copyAllCheckbox').addEventListener('change', (e) => {
            if (!e.target.checked) {
                selectedParts.clear();
                updatePartSelection();
            }
        });
    </script>
</body>
</html>
