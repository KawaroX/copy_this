<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«é€Ÿå¤åˆ¶</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', sans-serif;
            background: #f7f7f5;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: #37352f;
        }
        
        .container {
            background: white;
            border-radius: 8px;
            padding: 48px 40px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05), 0 10px 40px rgba(0, 0, 0, 0.08);
            max-width: 600px;
            width: 100%;
        }
        
        .header {
            margin-bottom: 32px;
        }
        
        .icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
        
        h1 {
            font-size: 24px;
            font-weight: 600;
            color: #37352f;
            margin-bottom: 8px;
        }
        
        .subtitle {
            color: #787774;
            font-size: 14px;
        }
        
        .content-section {
            margin: 24px 0;
        }
        
        .label {
            font-size: 12px;
            font-weight: 600;
            color: #787774;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        
        .display-box {
            background: #f7f7f5;
            border: 1px solid #e3e2e0;
            border-radius: 4px;
            padding: 16px;
            font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
            font-size: 18px;
            color: #37352f;
            word-break: break-all;
            line-height: 1.6;
        }
        
        .parts-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 12px;
        }
        
        .part-item {
            background: #f7f7f5;
            border: 1px solid #e3e2e0;
            border-radius: 4px;
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .part-item:hover {
            background: #f0f0ee;
            border-color: #d3d1cb;
        }
        
        /* æ–°å¢ï¼šé€‰ä¸­çŠ¶æ€çš„æ ·å¼ */
        .part-item.selected {
            background: #e3f2fd;
            border-color: #90caf9;
        }
        
        .part-text {
            font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
            font-size: 15px;
            color: #37352f;
            flex: 1;
        }
        
        .part-label {
            font-size: 11px;
            color: #787774;
            margin-bottom: 4px;
            font-weight: 500;
        }
        
        .copy-indicator {
            color: #787774;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .part-item:hover .copy-indicator {
            opacity: 1;
        }
        
        .button-group {
            display: flex;
            gap: 8px;
            margin-top: 24px;
        }
        
        .btn {
            flex: 1;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }
        
        .btn-primary {
            background: #37352f;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2e2c28;
        }
        
        .btn-primary:active {
            transform: scale(0.98);
        }
        
        .btn-secondary {
            background: white;
            color: #37352f;
            border: 1px solid #e3e2e0;
        }
        
        .btn-secondary:hover {
            background: #f7f7f5;
        }
        
        .status {
            margin-top: 16px;
            padding: 12px 16px;
            border-radius: 4px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status.show {
            opacity: 1;
        }
        
        .status.success {
            background: #edf3ec;
            color: #0f7b6c;
        }
        
        .status.error {
            background: #fdebec;
            color: #e03e3e;
        }
        
        .info-text {
            color: #9b9a97;
            font-size: 13px;
            margin-top: 20px;
            line-height: 1.5;
        }
        
        .divider {
            height: 1px;
            background: #e3e2e0;
            margin: 24px 0;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 8px 0;
        }
        
        .checkbox-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
        
        .checkbox-item label {
            font-size: 14px;
            cursor: pointer;
            user-select: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="icon">ğŸ“‹</div>
            <h1 id="title">å¿«é€Ÿå¤åˆ¶</h1>
            <div class="subtitle" id="subtitle">ç‚¹å‡»å†…å®¹å³å¯å¤åˆ¶åˆ°å‰ªè´´æ¿</div>
        </div>

        <div class="content-section" id="mainContent">
            <div class="label">å†…å®¹</div>
            <div class="display-box" id="fullContent">-</div>
        </div>

        <div class="content-section" id="partsSection" style="display: none;">
            <div class="label">é€‰æ‹©è¦å¤åˆ¶çš„éƒ¨åˆ†</div>
            <div class="parts-container" id="partsContainer"></div>
            <div class="checkbox-item" style="margin-top: 16px;">
                <input type="checkbox" id="copyAllCheckbox">
                <label for="copyAllCheckbox">ä¸€æ¬¡æ€§å¤åˆ¶æ‰€æœ‰é€‰ä¸­é¡¹</label>
            </div>
        </div>

        <div class="button-group">
            <button class="btn btn-primary" id="copyMainBtn">
                <span id="btnText">å¤åˆ¶</span>
            </button>
            <button class="btn btn-secondary" id="copyAllBtn" style="display: none;">
                å¤åˆ¶å…¨éƒ¨
            </button>
        </div>

        <div class="status" id="status"></div>

        <div class="divider"></div>

        <div class="info-text">
            <strong>ä½¿ç”¨æ–¹æ³•ï¼š</strong><br>
            â€¢ è‡ªåŠ¨å¤åˆ¶ï¼š<code>?code=å–ä»¶ç </code> (åŠ è½½åè‡ªåŠ¨å¤åˆ¶)<br>
            â€¢ åŸºç¡€å¤åˆ¶ï¼š<code>?text=å†…å®¹</code> (æ˜¾ç¤ºå®Œæ•´å†…å®¹)<br>
            â€¢ æ™ºèƒ½æ‹†åˆ†ï¼š<code>?text=å†…å®¹&mode=auto</code><br>
            â€¢ è‡ªå®šä¹‰åˆ†éš”ï¼š<code>?text=å†…å®¹&split=,</code><br>
            â€¢ å¤šä¸ªå€¼ï¼š<code>?values=å€¼1,å€¼2,å€¼3</code>
        </div>
    </div>

    <script>
        let currentMode = 'simple';
        let extractedParts = [];
        let selectedParts = new Set();

        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                code: params.get('code'),
                text: params.get('text'),
                mode: params.get('mode'),
                split: params.get('split'),
                values: params.get('values'),
                title: params.get('title')
            };
        }

        // ä¼˜åŒ–çš„ autoExtractPartsï¼Œé¿å…é‡å 
        function autoExtractParts(text) {
            const parts = [];
            let remainingText = text;

            // 1. æå–ä¸­æ–‡æ‹¬å·å†…å®¹
            // (?<=\ã€) æ˜¯æ­£å‘åè¡Œæ–­è¨€ï¼ŒåŒ¹é… ã€ åé¢çš„å†…å®¹ï¼Œ(?!=\ã€‘) æ˜¯è´Ÿå‘å‰è¡Œæ–­è¨€ï¼ŒåŒ¹é…ä¸ä»¥ ã€‘ ç»“å°¾çš„å†…å®¹
            // è¿™ç§å†™æ³•æ›´ç²¾ç¡®ï¼Œåªæå–æ‹¬å·å†…çš„å†…å®¹
            const brackets = text.match(/ã€([^ã€‘]+)ã€‘/g);
            if (brackets) {
                brackets.forEach((item, i) => {
                    const content = item.replace(/ã€|ã€‘/g, '');
                    parts.push({ label: `æ ‡ç­¾ ${i + 1}`, value: content, type: 'tag' });
                    remainingText = remainingText.replace(item, ' '); // ä»å‰©ä½™æ–‡æœ¬ä¸­ç§»é™¤
                });
            }

            // 2. æå–åœ°ç‚¹ä¿¡æ¯ (å¢åŠ äº†å¯¹ - çš„æ”¯æŒ)
            const locationRegex = /([\u4e00-\u9fa5A-Za-z0-9]+[æŸœæ¥¼]\s*[A-Z0-9-]+)/g;
            const locations = text.match(locationRegex);
            if (locations) {
                locations.forEach((loc, i) => {
                    parts.push({ label: `ä½ç½® ${i + 1}`, value: loc.trim(), type: 'location' });
                    remainingText = remainingText.replace(loc, ' '); // ä»å‰©ä½™æ–‡æœ¬ä¸­ç§»é™¤
                });
            }
            
            // 3. æå–å‰©ä½™æ–‡æœ¬ä¸­çš„æ•°å­—ï¼ˆ\b æ˜¯å•è¯è¾¹ç•Œï¼Œé˜²æ­¢åŒ¹é…åˆ°ä¸€åŠï¼‰
            const numbers = remainingText.match(/\b\d{6,}\b/g);
            if (numbers) {
                numbers.forEach((num, i) => {
                    parts.push({ label: `æ•°å­— ${i + 1}`, value: num, type: 'number' });
                });
            }
            
            return parts;
        }

        // ä¼˜åŒ–ï¼šä½¿ç”¨ createElement å’Œ addEventListener
        function renderParts(parts) {
            const container = document.getElementById('partsContainer');
            container.innerHTML = '';
            
            parts.forEach((part, index) => {
                const div = document.createElement('div');
                div.className = 'part-item';
                // è¡Œä¸ºç»‘å®š
                div.addEventListener('click', () => togglePart(index, part.value));
                
                const contentDiv = document.createElement('div');
                contentDiv.style.flex = '1';

                const labelDiv = document.createElement('div');
                labelDiv.className = 'part-label';
                labelDiv.textContent = part.label; // ä½¿ç”¨ textContent å®‰å…¨

                const textDiv = document.createElement('div');
                textDiv.className = 'part-text';
                textDiv.textContent = part.value; // ä½¿ç”¨ textContent å®‰å…¨

                contentDiv.appendChild(labelDiv);
                contentDiv.appendChild(textDiv);

                const indicatorDiv = document.createElement('div');
                indicatorDiv.className = 'copy-indicator';
                indicatorDiv.textContent = 'ç‚¹å‡»å¤åˆ¶';

                div.appendChild(contentDiv);
                div.appendChild(indicatorDiv);
                
                container.appendChild(div);
            });
        }

        function togglePart(index, value) {
            const checkbox = document.getElementById('copyAllCheckbox');
            
            if (checkbox.checked) {
                if (selectedParts.has(index)) {
                    selectedParts.delete(index);
                } else {
                    selectedParts.add(index);
                }
                updatePartSelection();
            } else {
                copyToClipboard(value, `å·²å¤åˆ¶ï¼š${value}`);
            }
        }

        // ä¼˜åŒ–ï¼šä½¿ç”¨ classList.toggle
        function updatePartSelection() {
            const items = document.querySelectorAll('.part-item');
            items.forEach((item, index) => {
                // ç¬¬äºŒä¸ªå‚æ•°ä¸º true æ—¶æ·»åŠ ç±»ï¼Œä¸º false æ—¶ç§»é™¤ç±»
                item.classList.toggle('selected', selectedParts.has(index));
            });
        }

        function showStatus(message, isSuccess) {
            const status = document.getElementById('status');
            status.innerHTML = `<span>${isSuccess ? 'âœ“' : 'âœ•'}</span> ${message}`;
            status.className = 'status show ' + (isSuccess ? 'success' : 'error');
            
            setTimeout(() => {
                status.classList.remove('show');
            }, 3000);
        }

        async function copyToClipboard(text, successMsg) {
            try {
                // ä¼˜å…ˆä½¿ç”¨ç°ä»£å¼‚æ­¥ Clipboard API
                await navigator.clipboard.writeText(text);
                showStatus(successMsg || 'å¤åˆ¶æˆåŠŸï¼', true);
            } catch (err) {
                // é™çº§å¤„ç†
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                textArea.style.top = '0';
                document.body.appendChild(textArea);
                textArea.select();
                
                try {
                    document.execCommand('copy');
                    showStatus(successMsg || 'å¤åˆ¶æˆåŠŸï¼', true);
                } catch (err2) {
                    showStatus('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', false);
                }
                
                document.body.removeChild(textArea);
            }
        }

        function copyContent() {
            const checkbox = document.getElementById('copyAllCheckbox');
            
            if (currentMode === 'parts' && checkbox.checked && selectedParts.size > 0) {
                const selected = extractedParts
                    .filter((_, index) => selectedParts.has(index))
                    .map(p => p.value)
                    .join('\n');
                copyToClipboard(selected, `å·²å¤åˆ¶ ${selectedParts.size} é¡¹å†…å®¹`);
            } else if (currentMode === 'simple') {
                const content = document.getElementById('fullContent').textContent;
                copyToClipboard(content, 'å·²å¤åˆ¶');
            } else if (currentMode === 'parts' && !checkbox.checked) {
                 showStatus('è¯·ç‚¹å‡»è¦å¤åˆ¶çš„å†…å®¹ï¼Œæˆ–å‹¾é€‰â€œä¸€æ¬¡æ€§å¤åˆ¶â€', false);
            } else if (currentMode === 'parts' && checkbox.checked && selectedParts.size === 0) {
                showStatus('è¯·ç‚¹å‡»é€‰æ‹©è¦å¤åˆ¶çš„å†…å®¹', false);
            }
        }

        function copyAll() {
            const content = document.getElementById('fullContent').textContent;
            copyToClipboard(content, 'å·²å¤åˆ¶å®Œæ•´å†…å®¹');
        }

        function init() {
            const params = getUrlParams();
            
            if (params.title) {
                document.getElementById('title').textContent = decodeURIComponent(params.title);
            }
            
            if (params.code) {
                currentMode = 'simple';
                document.getElementById('fullContent').textContent = params.code;
                document.getElementById('subtitle').textContent = 'å†…å®¹å·²è‡ªåŠ¨å¤åˆ¶åˆ°å‰ªè´´æ¿';
                copyToClipboard(params.code, 'å·²è‡ªåŠ¨å¤åˆ¶');
                return;
            }
            
            if (params.values) {
                currentMode = 'parts';
                const values = params.values.split(',').map(v => v.trim());
                document.getElementById('fullContent').textContent = values.join('\n');
                extractedParts = values.map((v, i) => ({ 
                    label: `é¡¹ç›® ${i + 1}`, 
                    value: v,
                    type: 'item'
                }));
                renderParts(extractedParts);
                document.getElementById('partsSection').style.display = 'block';
                document.getElementById('copyAllBtn').style.display = 'block';
                document.getElementById('btnText').textContent = 'å¤åˆ¶é€‰ä¸­';
                return;
            }
            
            if (params.text) {
                const text = decodeURIComponent(params.text);
                document.getElementById('fullContent').textContent = text;
                
                let processed = false;
                
                if (params.mode === 'auto') {
                    currentMode = 'parts';
                    extractedParts = autoExtractParts(text);
                    
                    if (extractedParts.length > 0) {
                        renderParts(extractedParts);
                        document.getElementById('partsSection').style.display = 'block';
                        document.getElementById('copyAllBtn').style.display = 'block';
                        document.getElementById('btnText').textContent = 'å¤åˆ¶é€‰ä¸­';
                        processed = true;
                    }
                }
                
                if (params.split && !processed) { // é¿å… auto å’Œ split åŒæ—¶ç”Ÿæ•ˆ
                    currentMode = 'parts';
                    const parts = text.split(params.split).map(v => v.trim()).filter(v => v);
                    extractedParts = parts.map((v, i) => ({ 
                        label: `éƒ¨åˆ† ${i + 1}`, 
                        value: v,
                        type: 'part'
                    }));
                    renderParts(extractedParts);
                    document.getElementById('partsSection').style.display = 'block';
                    document.getElementById('copyAllBtn').style.display = 'block';
                    document.getElementById('btnText').textContent = 'å¤åˆ¶é€‰ä¸­';
                }
                
                return;
            }
            
            showStatus('URLä¸­æœªæ‰¾åˆ°å†…å®¹å‚æ•°', false);
        }

        // --- ç»Ÿä¸€çš„äº‹ä»¶ç›‘å¬å™¨ ---
        
        window.addEventListener('load', init);
        
        document.getElementById('copyAllCheckbox').addEventListener('change', (e) => {
            if (!e.target.checked) {
                selectedParts.clear();
                updatePartSelection();
            }
        });

        document.getElementById('copyMainBtn').addEventListener('click', copyContent);
        document.getElementById('copyAllBtn').addEventListener('click', copyAll);
        
    </script>
</body>
</html>
