<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¿«é€Ÿå¤åˆ¶ Â· åŒé¡µé¢ï¼ˆè¾“å…¥/ç»“æœï¼‰</title>
  <!-- Faviconï¼šä½¿ç”¨ğŸ“¦è¡¨æƒ…ä½œä¸ºå›¾æ ‡ -->
  <link rel="icon" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">ğŸ“¦</text></svg>' />
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{--bg:#f8f8f6;--fg:#37352f;--muted:#787774;--line:#e3e2e0;--card:#fff;--accent:#0f7b6c}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Noto Sans',sans-serif;background:var(--bg);color:var(--fg);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:16px}
    .wrap{width:100%;max-width:720px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;box-shadow:0 1px 3px rgba(0,0,0,.04),0 10px 36px rgba(0,0,0,.06);padding:20px}
    .head{display:flex;align-items:center;gap:10px;margin-bottom:12px}
    .head .icon{font-size:28px}
    h1{font-size:20px}
    .sub{color:var(--muted);font-size:13px}

    .label{font-size:12px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.6px;margin:14px 0 8px}
    textarea,input[type=text]{width:100%;border:1px solid var(--line);border-radius:10px;padding:12px 14px;background:#fff;color:var(--fg);font:inherit}
    textarea{min-height:140px;resize:vertical}
    .row{display:flex;gap:10px;align-items:center}
    .row>*{flex:1}
    .opt{display:flex;align-items:center;gap:8px}
    .small{font-size:12px;color:var(--muted)}
    .btn{border:none;border-radius:10px;padding:12px 16px;font-weight:700;cursor:pointer}
    .btn-primary{background:var(--fg);color:#fff}
    .btn-primary:active{transform:scale(.985)}
    .btn-secondary{background:#fff;color:var(--fg);border:1px solid var(--line)}

    .display{white-space:pre-wrap;word-break:break-word;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;border:1px solid var(--line);background:#fff;border-radius:10px;padding:12px}
    .parts{display:flex;flex-direction:column;gap:10px}
    .part{display:flex;gap:10px;align-items:center;border:1px solid var(--line);background:#fff;border-radius:12px;padding:10px 12px}
    .part:hover{background:#f6f6f4}
    .k{min-width:72px;font-size:11px;color:var(--muted)}
    .v{flex:1}
    .active{border-color:#90caf9;background:#e3f2fd}

    .status{margin-top:8px;padding:10px 12px;border-radius:10px;display:none}
    .status.show{display:block}
    .ok{background:#edf3ec;color:#0f7b6c}
    .err{background:#fdebec;color:#e03e3e}

    .footer{margin-top:12px;color:#9b9a97;font-size:12px}

    /* Mobile ä¼˜åŒ–ï¼šå›ºå®šåº•éƒ¨æŒ‰é’®æ¡ */
    .bar{position:sticky;bottom:0;display:flex;gap:8px;background:linear-gradient(180deg,rgba(248,248,246,0),var(--bg) 40%);padding-top:10px}
    .bar .btn{flex:1}

    /* è§†å›¾éšè—æ§åˆ¶ */
    [data-view]{display:none}
    [data-view].show{display:block}
  </style>
</head>
<body>
  <div class="wrap">

    <!-- è¾“å…¥é¡µ -->
    <section id="view-input" data-view class="card">
      <div class="head"><div class="icon">ğŸ“‹</div><div><h1>å¿«é€Ÿå¤åˆ¶</h1><div class="sub">è¾“å…¥/ç²˜è´´çŸ­ä¿¡ â†’ æ™ºèƒ½æŠ½å– â†’ ç”Ÿæˆå¯åˆ†äº«é“¾æ¥ï¼›æ‰‹æœºä¸Šæ›´å¥½ç”¨</div></div></div>

      <div class="label">è¾“å…¥æ–‡æœ¬</div>
      <textarea id="ipt-text" placeholder="ç²˜è´´å¿«é€’çŸ­ä¿¡æˆ–ä»»æ„æ–‡æœ¬... åœ°å€ï¼šâ€¦"></textarea>

      <div class="row" style="margin-top:10px">
        <label class="opt"><input type="checkbox" id="ipt-auto" checked> è‡ªåŠ¨åˆ†ç¦»</label>
        <div class="opt" style="flex:.9"><span class="small">è‡ªå®šä¹‰åˆ†éš”ç¬¦</span><input id="ipt-split" type="text" placeholder=", æˆ– | æˆ– \n" /></div>
      </div>

      <div class="bar" style="margin-top:12px">
        <button id="btn-go" class="btn btn-primary">è§£æå¹¶æŸ¥çœ‹ç»“æœ</button>
        <button id="btn-link" class="btn btn-secondary">ç”Ÿæˆåˆ†äº«é“¾æ¥</button>
      </div>

      <div id="status-input" class="status"></div>

      <div class="footer">
        URL å‚æ•°ï¼š<code>?code=å†…å®¹</code>ã€<code>?text=å†…å®¹&mode=auto</code>ã€<code>?text=å†…å®¹&split=,</code>ã€<code>?values=1,2,3</code>
      </div>
    </section>

    <!-- ç»“æœé¡µ -->
    <section id="view-result" data-view class="card">
      <div class="head">
        <button id="btn-back" class="btn btn-secondary" style="padding:8px 12px">â† è¿”å›</button>
        <div><h1>è§£æç»“æœ</h1><div class="sub">ç‚¹å‡»ä»»æ„æ¡ç›®å³å¯å¤åˆ¶ï¼›æ”¯æŒå¤šé€‰æ‰¹é‡å¤åˆ¶</div></div>
      </div>

      <div class="label">åŸæ–‡</div>
      <div id="full" class="display">-</div>

      <div class="label">æŠ½å–é¡¹</div>
      <div id="parts" class="parts"></div>

      <div class="row" style="margin-top:10px">
        <label class="opt small"><input type="checkbox" id="opt-multi"> å¤šé€‰æ¨¡å¼</label>
        <div class="opt small"><input type="checkbox" id="opt-onlycode"> åªçœ‹å–ä»¶ç /ç ç±»</div>
      </div>

      <div class="bar" style="margin-top:12px">
        <button id="btn-copy-all" class="btn btn-secondary">å¤åˆ¶åŸæ–‡</button>
        <button id="btn-copy-selected" class="btn btn-primary" disabled>å¤åˆ¶é€‰ä¸­ï¼ˆ0ï¼‰</button>
      </div>

      <div id="status-result" class="status"></div>
    </section>

  </div>

  <script>
    const $ = (id)=>document.getElementById(id);

    /* ======= è·¯ç”±ï¼ˆè¾“å…¥/ç»“æœ ä¸¤é¡µï¼‰ ======= */
    function show(view){
      for (const el of document.querySelectorAll('[data-view]')) el.classList.remove('show');
      $(view).classList.add('show');
    }

    function navigateToResult(params){
      const url = new URL(location.href);
      url.searchParams.set('view','result');
      for (const [k,v] of Object.entries(params)) if(v!=null) url.searchParams.set(k,v);
      history.pushState({page:'result'}, '', url);
      renderFromParams();
    }

    function navigateToInput(){
      const url = new URL(location.href);
      url.searchParams.delete('view');
      url.searchParams.delete('text');
      url.searchParams.delete('code');
      url.searchParams.delete('values');
      url.searchParams.delete('mode');
      url.searchParams.delete('split');
      history.pushState({page:'input'}, '', url.pathname + url.search);
      renderFromParams();
    }

    window.addEventListener('popstate', renderFromParams);

    /* ======= å·¥å…· ======= */
    const sanitize = (s='')=> s
      .replace(/[\u200B-\u200D\uFEFF]/g,'') // å»é›¶å®½
      .replace(/[\s\t\xA0]+/g,' ') // åˆå¹¶ç©ºæ ¼
      .replace(/\s*([ï¼Œã€‚ï¼›,;:ï¼š])\s*/g,'$1');

    async function copy(text, okMsg='å·²å¤åˆ¶'){
      try{ await navigator.clipboard.writeText(text); toast(okMsg,true) }
      catch{
        const ta=document.createElement('textarea'); ta.value=text; ta.style.position='fixed'; ta.style.left='-9999px'; document.body.appendChild(ta); ta.select();
        try{ document.execCommand('copy'); toast(okMsg,true) } catch{ toast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶',false) }
        document.body.removeChild(ta);
      }
    }

    function toast(msg, ok=true, where='input'){
      const el = where==='input' ? $('status-input') : $('status-result');
      el.textContent = msg; el.className = 'status show ' + (ok?'ok':'err');
      clearTimeout(el._t); el._t = setTimeout(()=>{ el.className = 'status' }, 2600);
    }

    /* ======= æ™ºèƒ½æŠ½å–ï¼ˆå¼ºåŒ–ç‰ˆï¼‰ ======= */
    function extractAll(raw){
      const text = sanitize(raw);
      const out = [];
      const seen = new Set();
      const push = (key,val,type)=>{ const v=(val||'').trim(); const k=key+'|'+v; if(v && !seen.has(k)){ seen.add(k); out.push({key,val:v,type}); } };

      // 1) ã€æ ‡ç­¾ã€‘
      (text.match(/ã€([^ã€‘]+)ã€‘/g)||[]).forEach(t=> push('æ ‡ç­¾', t.replace(/ã€|ã€‘/g,''), 'tag'));

      // 2) URL
      (text.match(/https?:\/\/[^\s"'<>()ï¼Œã€‚ï¼›ã€ï¼‰)]+/g)||[]).forEach(u=> push('é“¾æ¥', u, 'url'));

      // 3) ç”µè¯ï¼ˆæ‰‹æœº/åº§æœºï¼Œå…è®¸ç©ºæ ¼/çŸ­æ¨ªï¼‰
      (text.match(/(?<!\d)(1[3-9]\d[\s-]?\d{4}[\s-]?\d{4})(?!\d)/g)||[])
        .forEach(p=> push('ç”µè¯', p.replace(/[\s-]/g,''), 'phone'));
      (text.match(/(?<!\d)(0\d{2,3}-?\d{7,8})(?!\d)/g)||[])
        .forEach(p=> push('åº§æœº', p, 'phone'));

      // 4) æ—¶é—´ï¼ˆHH:MMï¼‰
      (text.match(/(?<!\d)([01]?\d|2[0-3]):[0-5]\d(?!\d)/g)||[]).forEach(t=> push('æ—¶é—´', t, 'time'));

      // 5) å–ä»¶ç /éªŒè¯ç ï¼šå«å…³é”®è¯ æˆ– â€œå‡­X-1234/123456/AB1234â€
      const codeKw = /(å–ä»¶ç |å–è´§ç |æå–ç |éªŒè¯ç |æ ¡éªŒç |æ ¸éªŒç |å‡­)\s*[:ï¼š]?\s*([A-Z]{1,3}?[- ]?\d{3,8}|\d{4,8})/gi;
      let m; while((m = codeKw.exec(text))) push('å–ä»¶ç ', m[2].replace(/\s/g,''), 'code');
      // å…³é”®è¯ç¼ºå¤±æ—¶ï¼Œé â€œå‡­â€+ç  æˆ–è€… JD/SF/ä¸­é€šç­‰å¸¸è§å‰ç¼€
      const codeLoose = /(?:å‡­|ç )\s*([A-Z]{1,3}?-?\d{3,8})/gi; let mm; while((mm = codeLoose.exec(text))) push('å–ä»¶ç ', mm[1].replace(/\s/g,''), 'code');
      // å¸¸è§å¿«é€’å‰ç¼€ + æ•°å­—
      (text.match(/\b(?:JD|SF|ZTO|YT|YTO|STO|YD|BS|ZJS|HT|DB|S)?[A-Z]?[- ]?\d{4,8}\b/g)||[])
        .forEach(c=>{ if(/\d/.test(c)) push('å¯èƒ½çš„å–ä»¶ç ', c.replace(/\s/g,''), 'code-maybe') });

      // 6) å°¾å·
      let t; const tail=/å°¾å·\s*(\d{2,4})/g; while((t=tail.exec(text))) push('å°¾å·', t[1], 'tail');

      // 7) åœ°å€ï¼ˆä»â€œåœ°å€/å·²é€è¾¾è‡³/åˆ°â€¦/è‡³ â€¦â€åˆ°ä¸‹ä¸€é”šç‚¹ï¼‰
      const anchors = /(åœ°å€|å–ä»¶åœ°å€|å·²é€è¾¾|é€è¾¾|åˆ°|è‡³)\s*[:ï¼š]?\s*([\u4e00-\u9fa5A-Za-z0-9\-ï¼ˆï¼‰() ]{6,}?)(?=è”ç³»ç”µè¯|ç”µè¯|å–ä»¶|å¯„ä»¶|è¯·|https?:\/\/|ã€‚|ï¼Œ|ï¼›|$)/g;
      let a; while((a=anchors.exec(text))){ push('åœ°å€/åœ°ç‚¹', a[2].replace(/[ï¼Œã€‚ï¼›]$/,'').trim(), 'address'); }

      // 8) åœ°ç‚¹ï¼ˆå« æŸœ/æ¥¼/åº§/æœåŠ¡ç«™/é©¿ç«™ ç­‰ï¼Œå¸¦æ ¼ä½ï¼‰
      (text.match(/[\u4e00-\u9fa5A-Za-z0-9\- ]{0,20}(?:å¿«é€’æŸœ|è¿‘é‚»å®|æœåŠ¡ç«™|é©¿ç«™|æ–°ä¸»æ¥¼|æ–°åŒ—|[ä¸œå—è¥¿åŒ—]ä¾§)?[\u4e00-\u9fa5]*?(?:æŸœ|æ¥¼|åº§)[\u4e00-\u9fa5 ]*([A-Z]-?\d{1,3}|\d+å·æŸœ|[A-Z]?\d{1,3})/g)||[])
        .forEach(l=> push('åœ°ç‚¹', l.trim(), 'location'));

      // 9) çº¯æ•°å­—ä¸²ï¼ˆ>=6ï¼‰ï¼Œæ’é™¤ç”µè¯/å°¾å·
      const taken = new Set(out.filter(x=>x.type==='phone'||x.type==='tail').map(x=>x.val));
      (text.match(/\b\d{6,}\b/g)||[]).forEach(n=>{ if(!taken.has(n)) push('æ•°å­—', n, 'number') });

      // å¿«é€’å“ç‰Œï¼ˆæç¤ºæ¥æºï¼‰
      (text.match(/äº¬ä¸œå¿«é€’|é¡ºä¸°|ä¸­é€š|åœ†é€š|ç”³é€š|éŸµè¾¾|é‚®æ”¿|EMS|æå…”|å¾·é‚¦|èœé¸Ÿ|é©¿å°å“¥/gi)||[]) 
        .forEach(b=> push('å¿«é€’', b, 'brand'));

      return out;
    }

    /* ======= æ¸²æŸ“ ======= */
    let extracted=[]; const selected=new Set();

    function renderParts(){
      const onlyCode = $('opt-onlycode').checked;
      const list = onlyCode ? extracted.filter(x=>x.type.startsWith('code')) : extracted;
      const box = $('parts'); box.innerHTML='';
      list.forEach((p,idx)=>{
        const i = document.createElement('div'); i.className = 'part' + (selected.has(idx)?' active':'');
        const k = document.createElement('div'); k.className='k'; k.textContent=p.key;
        const v = document.createElement('div'); v.className='v'; v.textContent=p.val;
        i.append(k,v);
        i.addEventListener('click', ()=> onPartClick(idx,p.val));
        box.appendChild(i);
      });
      updateCopySelected();
    }

    function onPartClick(idx,val){
      if(!$('opt-multi').checked){ copy(val, `å·²å¤åˆ¶ï¼š${val}`, 'result'); return; }
      if(selected.has(idx)) selected.delete(idx); else selected.add(idx); renderParts();
    }

    function updateCopySelected(){
      const n = selected.size; const btn=$('btn-copy-selected');
      btn.textContent = `å¤åˆ¶é€‰ä¸­ï¼ˆ${n}ï¼‰`; btn.disabled = n===0;
    }

    /* ======= ä»å‚æ•°æ¸²æŸ“ç»“æœé¡µ ======= */
    function renderFromParams(){
      const sp = new URLSearchParams(location.search);
      const view = sp.get('view');
      if(view==='result'){
        show('view-result');
        const code = sp.get('code'); const values = sp.get('values'); const text = sp.get('text'); const mode = sp.get('mode'); const split = sp.get('split');
        selected.clear();
        if(code){ $('full').textContent = code; extracted = extractAll(code); renderParts(); copy(code,'å·²è‡ªåŠ¨å¤åˆ¶','result'); return; }
        if(values){ const arr = values.split(',').map(s=>s.trim()).filter(Boolean); $('full').textContent = arr.join('\n'); extracted = arr.map((v,i)=>({key:`é¡¹ç›®${i+1}`,val:v,type:'item'})); renderParts(); return; }
        if(text){ $('full').textContent = text; if(split){ const segs = text.split(split.replace(/\\n/g,'\n')).map(s=>s.trim()).filter(Boolean); extracted = segs.map((v,i)=>({key:`éƒ¨åˆ†${i+1}`,val:v,type:'part'})); } else if(mode==='auto'){ extracted = extractAll(text); } else { extracted=[]; }
          renderParts(); return; }
        // æ²¡æœ‰å‚æ•°ï¼šå›è¾“å…¥
        show('view-input');
      } else {
        show('view-input');
      }
    }

    /* ======= äº‹ä»¶ç»‘å®š ======= */
    $('btn-go').addEventListener('click', ()=>{
      const t = $('ipt-text').value.trim(); if(!t){ toast('è¯·è¾“å…¥å†…å®¹',false,'input'); return; }
      const auto = $('ipt-auto').checked; const sp = $('ipt-split').value.trim();
      const params = { text: t };
      if(sp) params.split = sp; else if(auto) params.mode = 'auto';
      navigateToResult(params);
    });

    $('btn-link').addEventListener('click', ()=>{
      const t = $('ipt-text').value.trim(); if(!t){ toast('è¯·è¾“å…¥å†…å®¹ä»¥ç”Ÿæˆé“¾æ¥',false,'input'); return; }
      const auto = $('ipt-auto').checked; const sp = $('ipt-split').value.trim();
      const url = new URL(location.href); url.search = '';
      const p = new URLSearchParams(); p.set('view','result'); p.set('text',t);
      if(sp) p.set('split',sp); else if(auto) p.set('mode','auto');
      const out = url.toString() + '?' + p.toString();
      copy(out,'å·²å¤åˆ¶åˆ†äº«é“¾æ¥','input');
    });

    $('btn-back').addEventListener('click', ()=> history.back());
    $('btn-copy-all').addEventListener('click', ()=> copy($('full').textContent,'å·²å¤åˆ¶åŸæ–‡','result'));
    $('btn-copy-selected').addEventListener('click', ()=>{
      const list=[...selected].sort((a,b)=>a-b).map(i=>extracted[i].val).join('\n');
      copy(list,`å·²å¤åˆ¶ ${selected.size} é¡¹`,'result');
    });
    $('opt-multi').addEventListener('change', ()=>{ selected.clear(); renderParts(); });
    $('opt-onlycode').addEventListener('change', renderParts);

    // åˆå§‹æ¸²æŸ“
    renderFromParams();
  </script>
</body>
</html>
