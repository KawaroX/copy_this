<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>快速复制</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', sans-serif;
            background: #f7f7f5;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: #37352f;
        }
        
        .container {
            background: white;
            border-radius: 8px;
            padding: 48px 40px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05), 0 10px 40px rgba(0, 0, 0, 0.08);
            max-width: 600px;
            width: 100%;
        }
        
        .header {
            margin-bottom: 32px;
        }
        
        .icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
        
        h1 {
            font-size: 24px;
            font-weight: 600;
            color: #37352f;
            margin-bottom: 8px;
        }
        
        .subtitle {
            color: #787774;
            font-size: 14px;
        }
        
        .content-section {
            margin: 24px 0;
        }
        
        /* 新增：输入框样式 */
        #textInput {
            width: 100%;
            border: 1px solid #e3e2e0;
            border-radius: 4px;
            padding: 12px;
            font-family: inherit;
            font-size: 14px;
            resize: vertical;
        }

        /* 新增：输入选项样式 */
        .options-group {
            margin-top: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .options-group .input-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .options-group .input-group label {
            font-size: 14px;
            white-space: nowrap;
            color: #37352f;
        }

        .options-group .input-group input[type="text"] {
            flex: 1;
            border: 1px solid #e3e2e0;
            border-radius: 4px;
            padding: 6px 10px;
            font-size: 14px;
        }
        
        .label {
            font-size: 12px;
            font-weight: 600;
            color: #787774;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        
        .display-box {
            background: #f7f7f5;
            border: 1px solid #e3e2e0;
            border-radius: 4px;
            padding: 16px;
            font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
            font-size: 18px;
            color: #37352f;
            word-break: break-all;
            line-height: 1.6;
            min-height: 50px;
        }
        
        .parts-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 12px;
        }
        
        .part-item {
            background: #f7f7f5;
            border: 1px solid #e3e2e0;
            border-radius: 4px;
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .part-item:hover {
            background: #f0f0ee;
            border-color: #d3d1cb;
        }
        
        .part-text {
            font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
            font-size: 15px;
            color: #37352f;
            flex: 1;
            word-break: break-all;
        }
        
        .part-label {
            font-size: 11px;
            color: #787774;
            margin-bottom: 4px;
            font-weight: 500;
        }
        
        .copy-indicator {
            color: #787774;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.2s;
            padding-left: 10px;
        }
        
        .part-item:hover .copy-indicator {
            opacity: 1;
        }
        
        .button-group {
            display: flex;
            gap: 8px;
            margin-top: 24px;
        }
        
        .btn {
            flex: 1;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }
        
        .btn-primary {
            background: #37352f;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2e2c28;
        }
        
        .btn-primary:active {
            transform: scale(0.98);
        }
        
        .btn-secondary {
            background: white;
            color: #37352f;
            border: 1px solid #e3e2e0;
        }
        
        .btn-secondary:hover {
            background: #f7f7f5;
        }

        /* 新增：用于返回按钮 */
        .btn-back {
            flex: 0 1 auto; /* 不拉伸，保持内容宽度 */
            padding: 10px 16px;
        }
        
        .status {
            margin-top: 16px;
            padding: 12px 16px;
            border-radius: 4px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status.show {
            opacity: 1;
        }
        
        .status.success {
            background: #edf3ec;
            color: #0f7b6c;
        }
        
        .status.error {
            background: #fdebec;
            color: #e03e3e;
        }
        
        .info-text {
            color: #9b9a97;
            font-size: 13px;
            margin-top: 20px;
            line-height: 1.5;
        }
        
        .divider {
            height: 1px;
            background: #e3e2e0;
            margin: 24px 0;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 8px 0;
        }
        
        .checkbox-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
        
        .checkbox-item label {
            font-size: 14px;
            cursor: pointer;
            user-select: none;
            color: #37352f;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="icon">📋</div>
            <h1 id="title">快速复制</h1>
            <div class="subtitle" id="subtitle">点击内容即可复制到剪贴板</div>
        </div>

        <div class="content-section" id="inputSection" style="display: none;">
            <div class="label">输入内容</div>
            <textarea id="textInput" rows="5" placeholder="在此粘贴您的文本..."></textarea>
            
            <div class="options-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="autoSplitCheckbox" checked>
                    <label for="autoSplitCheckbox">智能拆分</label>
                </div>
                <div class="input-group">
                    <label for="customSplitInput">自定义分隔符:</label>
                    <input type="text" id="customSplitInput" placeholder="例如：, 或 \n (换行)">
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" onclick="processInput()">处理内容</button>
                <button class="btn btn-secondary" onclick="generateLink()">生成分享链接</button>
            </div>
        </div>

        <div class="content-section" id="mainContent" style="display: none;">
            <div class="label">内容</div>
            <div class="display-box" id="fullContent">-</div>
        </div>

        <div class="content-section" id="partsSection" style="display: none;">
            <div class="label">选择要复制的部分</div>
            <div class="parts-container" id="partsContainer"></div>
            <div class="checkbox-item" style="margin-top: 16px;">
                <input type="checkbox" id="copyAllCheckbox">
                <label for="copyAllCheckbox">一次性复制所有选中项</label>
            </div>
        </div>

        <div class="button-group" id="mainActionButtons" style="display: none;">
            <button class="btn btn-primary" onclick="copyContent()">
                <span id="btnText">复制</span>
            </button>
            <button class="btn btn-secondary" onclick="copyAll()" id="copyAllBtn" style="display: none;">
                复制全部
            </button>
            <button class="btn btn-secondary btn-back" onclick="resetPage()" id="resetBtn">
                返回
            </button>
        </div>

        <div class="status" id="status"></div>

        <div class="divider"></div>

        <div class="info-text">
            <strong>使用方法：</strong><br>
            • 基础复制：<code>?code=内容</code><br>
            • 智能拆分：<code>?text=内容&mode=auto</code><br>
            • 自定义分隔：<code>?text=内容&split=,</code><br>
            • 多个值：<code>?values=值1,值2,值3</code>
        </div>
    </div>

    <script>
        let currentMode = 'simple';
        let extractedParts = [];
        let selectedParts = new Set();

        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                code: params.get('code'),
                text: params.get('text'),
                mode: params.get('mode'),
                split: params.get('split'),
                values: params.get('values'),
                title: params.get('title')
            };
        }

        /**
         * 优化的智能提取函数
         */
        function autoExtractParts(text) {
            const parts = [];
            const seen = new Set(); // 用于去重

            // 辅助函数，避免重复添加
            const addPart = (label, value, type) => {
                const trimmedValue = value.trim();
                if (trimmedValue && !seen.has(trimmedValue)) {
                    parts.push({ label, value: trimmedValue, type });
                    seen.add(trimmedValue);
                }
            };

            // 提取器定义
            const extractors = [
                // 1. 网址
                { label: '网址', regex: /(https?:\/\/[^\s"'<>()]+)/gi, group: 1 },
                // 2. 电话号码
                { label: '电话', regex: /(1[3-9]\d{9})(?!\d)/g, group: 1 },
                // 3. 【标签】
                { label: '标签', regex: /【([^】]+)】/g, group: 1 },
                // 4. 取件码 (包括字母)
                { label: '取件码', regex: /(?:取件码|取货码|验证码|提取码|code)\s*[:：]?\s*([A-Za-z0-9]+)/gi, group: 1 },
                // 5. 4位尾号
                { label: '尾号', regex: /(?:尾号)\s*(\d{4})/g, group: 1 },
                // 6. 地址
                { label: '地址', regex: /(?:地址|address)\s*[:：]?\s*([^\n，。]+(?:(?:省|市|区|路|号|楼|座|室|中心|服务站)[^\n，。]*))/gi, group: 1 },
                // 7. 6位以上纯数字（作为备用取件码）
                { label: '数字', regex: /(\d{6,})/g, group: 1 }
            ];

            for (const extractor of extractors) {
                let match;
                while ((match = extractor.regex.exec(text)) !== null) {
                    if (match[extractor.group]) {
                        addPart(extractor.label, match[extractor.group], extractor.label.toLowerCase());
                    }
                }
            }
            
            return parts;
        }

        function renderParts(parts) {
            const container = document.getElementById('partsContainer');
            container.innerHTML = '';
            
            parts.forEach((part, index) => {
                const div = document.createElement('div');
                div.className = 'part-item';
                div.onclick = () => togglePart(index, part.value);
                
                div.innerHTML = `
                    <div style="flex: 1;">
                        <div class="part-label">${part.label}</div>
                        <div class="part-text">${part.value}</div>
                    </div>
                    <div class="copy-indicator">点击复制</div>
                `;
                
                container.appendChild(div);
            });
        }

        function togglePart(index, value) {
            const checkbox = document.getElementById('copyAllCheckbox');
            
            if (checkbox.checked) {
                if (selectedParts.has(index)) {
                    selectedParts.delete(index);
                } else {
                    selectedParts.add(index);
                }
                updatePartSelection();
            } else {
                copyToClipboard(value, `已复制：${value}`);
            }
        }

        function updatePartSelection() {
            const items = document.querySelectorAll('.part-item');
            items.forEach((item, index) => {
                if (selectedParts.has(index)) {
                    item.style.background = '#e3f2fd';
                    item.style.borderColor = '#90caf9';
                } else {
                    item.style.background = '#f7f7f5';
                    item.style.borderColor = '#e3e2e0';
                }
            });
        }

        function showStatus(message, isSuccess) {
            const status = document.getElementById('status');
            status.innerHTML = `<span>${isSuccess ? '✓' : '✕'}</span> ${message}`;
            status.className = 'status show ' + (isSuccess ? 'success' : 'error');
            
            setTimeout(() => {
                status.classList.remove('show');
            }, 3000);
        }

        async function copyToClipboard(text, successMsg) {
            try {
                await navigator.clipboard.writeText(text);
                showStatus(successMsg || '复制成功！', true);
            } catch (err) {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                document.body.appendChild(textArea);
                textArea.select();
                
                try {
                    document.execCommand('copy');
                    showStatus(successMsg || '复制成功！', true);
                } catch (err2) {
                    showStatus('复制失败，请手动复制', false);
                }
                
                document.body.removeChild(textArea);
            }
        }

        function copyContent() {
            const checkbox = document.getElementById('copyAllCheckbox');
            
            if (currentMode === 'parts' && checkbox.checked && selectedParts.size > 0) {
                const selected = extractedParts
                    .filter((_, index) => selectedParts.has(index))
                    .map(p => p.value)
                    .join('\n');
                copyToClipboard(selected, `已复制 ${selectedParts.size} 项内容`);
            } else if (currentMode === 'simple') {
                const content = document.getElementById('fullContent').textContent;
                copyToClipboard(content, '已复制');
            } else if (currentMode === 'parts' && (!checkbox.checked || selectedParts.size === 0)) {
                 showStatus('请点击要复制的内容，或勾选“一次性复制”并选择', false);
            } else {
                const content = document.getElementById('fullContent').textContent;
                copyToClipboard(content, '已复制');
            }
        }

        function copyAll() {
            const content = document.getElementById('fullContent').textContent;
            copyToClipboard(content, '已复制完整内容');
        }

        /**
         * 新增：处理来自输入框的内容
         */
        function processInput() {
            const text = document.getElementById('textInput').value.trim();
            if (!text) {
                showStatus('请输入内容', false);
                return;
            }

            const customSplit = document.getElementById('customSplitInput').value;
            const autoSplit = document.getElementById('autoSplitCheckbox').checked;

            // 隐藏输入区，显示内容区
            document.getElementById('inputSection').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            document.getElementById('mainActionButtons').style.display = 'flex';

            document.getElementById('fullContent').textContent = text;
            extractedParts = [];
            selectedParts.clear();
            
            let parts = [];
            
            if (customSplit) {
                // 自定义分隔
                currentMode = 'parts';
                // 允许 \n 作为换行符
                const separator = customSplit.replace(/\\n/g, '\n');
                parts = text.split(separator).map(v => v.trim()).filter(v => v);
                extractedParts = parts.map((v, i) => ({ 
                    label: `部分 ${i + 1}`, 
                    value: v,
                    type: 'part'
                }));
            } else if (autoSplit) {
                // 智能拆分
                currentMode = 'parts';
                extractedParts = autoExtractParts(text);
            } else {
                // 简单模式
                currentMode = 'simple';
            }
            
            if (extractedParts.length > 0) {
                renderParts(extractedParts);
                document.getElementById('partsSection').style.display = 'block';
                document.getElementById('copyAllBtn').style.display = 'block';
                document.getElementById('btnText').textContent = '复制选中';
            } else {
                document.getElementById('partsSection').style.display = 'none';
                document.getElementById('copyAllBtn').style.display = 'none';
                document.getElementById('btnText').textContent = '复制';
            }
        }

        /**
         * 新增：生成分享链接
         */
        function generateLink() {
            const text = document.getElementById('textInput').value.trim();
            if (!text) {
                showStatus('请输入内容以生成链接', false);
                return;
            }
            
            const customSplit = document.getElementById('customSplitInput').value;
            const autoSplit = document.getElementById('autoSplitCheckbox').checked;
            
            const baseUrl = window.location.origin + window.location.pathname;
            let params = new URLSearchParams();
            
            params.set('text', text);
            
            if (customSplit) {
                params.set('split', customSplit);
            } else if (autoSplit) {
                params.set('mode', 'auto');
            }
            
            const url = `${baseUrl}?${params.toString()}`;
            copyToClipboard(url, '分享链接已复制！');
        }

        /**
         * 新增：返回输入界面
         */
        function resetPage() {
            // 使用 pathname 重置页面，清除所有URL参数
            window.location.href = window.location.pathname;
        }

        /**
         * 新增：根据参数设置页面
         */
        function setupFromParams(params) {
            // 显示主内容区和按钮
            document.getElementById('mainContent').style.display = 'block';
            document.getElementById('mainActionButtons').style.display = 'flex';

            // 设置标题
            if (params.title) {
                document.getElementById('title').textContent = decodeURIComponent(params.title);
            }
            
            // 简单模式：直接复制 code
            if (params.code) {
                currentMode = 'simple';
                const code = decodeURIComponent(params.code);
                document.getElementById('fullContent').textContent = code;
                document.getElementById('subtitle').textContent = '内容已自动复制到剪贴板';
                copyToClipboard(code, '已自动复制内容');
                return;
            }
            
            // 多值模式
            if (params.values) {
                currentMode = 'parts';
                const values = decodeURIComponent(params.values).split(',').map(v => v.trim());
                document.getElementById('fullContent').textContent = values.join('\n');
                extractedParts = values.map((v, i) => ({ 
                    label: `项目 ${i + 1}`, 
                    value: v,
                    type: 'item'
                }));
                renderParts(extractedParts);
                document.getElementById('partsSection').style.display = 'block';
                document.getElementById('copyAllBtn').style.display = 'block';
                document.getElementById('btnText').textContent = '复制选中';
                return;
            }
            
            // 文本处理模式
            if (params.text) {
                const text = decodeURIComponent(params.text);
                document.getElementById('fullContent').textContent = text;
                
                // 自动识别模式
                if (params.mode === 'auto') {
                    currentMode = 'parts';
                    extractedParts = autoExtractParts(text);
                    
                    if (extractedParts.length > 0) {
                        renderParts(extractedParts);
                        document.getElementById('partsSection').style.display = 'block';
                        document.getElementById('copyAllBtn').style.display = 'block';
                        document.getElementById('btnText').textContent = '复制选中';
                    }
                }
                
                // 自定义分隔符
                else if (params.split) {
                    currentMode = 'parts';
                    const separator = decodeURIComponent(params.split).replace(/\\n/g, '\n');
                    const parts = text.split(separator).map(v => v.trim()).filter(v => v);
                    extractedParts = parts.map((v, i) => ({ 
                        label: `部分 ${i + 1}`, 
                        value: v,
                        type: 'part'
                    }));
                    renderParts(extractedParts);
                    document.getElementById('partsSection').style.display = 'block';
                    document.getElementById('copyAllBtn').style.display = 'block';
                    document.getElementById('btnText').textContent = '复制选中';
                }
                
                // 默认简单模式
                else {
                    currentMode = 'simple';
                }
                return;
            }
        }
        
        /**
         * 新增：设置输入模式
         */
        function setupInputMode() {
            document.getElementById('inputSection').style.display = 'block';
            document.getElementById('subtitle').textContent = '粘贴内容或使用URL参数';
            // 确保其他部分隐藏
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('partsSection').style.display = 'none';
            document.getElementById('mainActionButtons').style.display = 'none';
        }

        function init() {
            const params = getUrlParams();
            
            // 检查是否有任何有效参数
            if (params.code || params.text || params.values) {
                setupFromParams(params);
            } else {
                // 没有参数，进入输入模式
                setupInputMode();
            }
        }

        window.addEventListener('load', init);
        
        document.getElementById('copyAllCheckbox').addEventListener('change', (e) => {
            if (!e.target.checked) {
                selectedParts.clear();
                updatePartSelection();
            }
        });
    </script>
</body>
</html>
