<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¿«é€Ÿå¤åˆ¶ Â· æ”¹è¿›ç‰ˆ</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root { --bg:#f7f7f5; --fg:#37352f; --muted:#787774; --line:#e3e2e0; --card:#fff; --accent:#0f7b6c; }
    body { font-family: -apple-system,BlinkMacSystemFont,'Segoe UI','Noto Sans',sans-serif; background: var(--bg); min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; color: var(--fg); }
    .container { background: var(--card); border-radius: 12px; padding: 40px 32px; width: 100%; max-width: 860px; box-shadow: 0 1px 3px rgba(0,0,0,.05),0 10px 40px rgba(0,0,0,.08); display: grid; grid-template-columns: 1.2fr .8fr; gap: 28px; }
    @media (max-width: 900px){ .container{ grid-template-columns: 1fr; } }
    .header{ grid-column: 1/-1; margin-bottom: -8px; }
    .icon{ font-size: 40px; margin-bottom: 6px; }
    h1{ font-size: 24px; font-weight: 700; }
    .subtitle{ color: var(--muted); font-size: 14px; margin-top: 4px; }

    .section{ background: var(--bg); border: 1px solid var(--line); border-radius: 10px; padding: 16px; }
    .section + .section{ margin-top: 16px; }
    .label{ font-size: 12px; font-weight: 700; color: var(--muted); text-transform: uppercase; letter-spacing: .6px; margin-bottom: 10px; }

    .display-box{ background:#fff; border:1px solid var(--line); border-radius:8px; padding:14px; font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace; font-size: 15px; color: var(--fg); line-height: 1.6; white-space: pre-wrap; word-break: break-word; }

    .parts{ display:flex; flex-direction:column; gap:10px; }
    .part{ display:flex; align-items:center; gap:12px; background:#fff; border:1px solid var(--line); border-radius:10px; padding:10px 12px; cursor:pointer; transition:.12s ease; }
    .part:hover{ border-color:#d3d1cb; background:#f0f0ee; }
    .part.active{ border-color:#90caf9; background:#e3f2fd; }
    .part-k{ font-size:11px; color: var(--muted); min-width: 86px; }
    .part-v{ font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace; font-size: 14px; color: var(--fg); flex:1; }

    .row{ display:flex; gap:10px; align-items:center; }
    .row > *{ flex:1; }
    .btn{ border:none; padding:10px 16px; border-radius:8px; font-weight:600; cursor:pointer; transition:.12s ease; }
    .btn-primary{ background: var(--fg); color:#fff; }
    .btn-primary:hover{ filter: brightness(.9); }
    .btn-secondary{ background:#fff; color: var(--fg); border:1px solid var(--line); }
    .btn-secondary:hover{ background:#f7f7f5; }

    .status{ margin-top:10px; padding:10px 12px; border-radius:8px; font-size:14px; display:none; }
    .status.show{ display:flex; align-items:center; gap:8px; }
    .status.ok{ background:#edf3ec; color:#0f7b6c; }
    .status.err{ background:#fdebec; color:#e03e3e; }

    .hint{ color:#9b9a97; font-size:12px; line-height:1.5; }
    .divider{ height:1px; background:var(--line); margin:12px 0; }

    textarea,input[type="text"]{ width:100%; border:1px solid var(--line); border-radius:8px; padding:10px 12px; background:#fff; color:var(--fg); font:inherit; }
    .small{ font-size:12px; color:var(--muted); }
    .opt{ display:flex; align-items:center; gap:8px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="icon">ğŸ“‹</div>
      <h1 id="title">å¿«é€Ÿå¤åˆ¶</h1>
      <div class="subtitle" id="subtitle">å¯è‡ªåŠ¨è¯†åˆ«å–ä»¶ç ã€ç”µè¯ã€ç½‘å€ã€åœ°å€ç­‰ï¼›æ”¯æŒç”Ÿæˆå¯åˆ†äº«é“¾æ¥</div>
    </div>

    <!-- å·¦ä¾§ï¼šè¾“å…¥ & é¢„è§ˆ -->
    <div class="left">
      <div class="section">
        <div class="label">è¾“å…¥æ–‡æœ¬ï¼ˆæœªä¼ å…¥å‚æ•°æ—¶å¯ç”¨ï¼‰</div>
        <textarea id="input" rows="6" placeholder="ç²˜è´´å¿«é€’çŸ­ä¿¡æˆ–ä»»æ„æ–‡æœ¬ï¼Œä¾‹å¦‚ï¼š\nã€äº¬ä¸œå¿«é€’ã€‘å–ä»¶ç S0246ï¼Œæ‚¨çš„å¿«ä»¶å°¾å·1864å·²é€è¾¾åŒ—äº¬åŒ—èˆªæ ¡å›­æœåŠ¡ç«™ï¼Œåœ°å€ï¼šâ€¦â€¦ï¼Œè”ç³»ç”µè¯ 18210824625ï¼Œå–ä»¶å’Œå¯„ä»¶å¯å’¨è¯¢ https://3.cn/10ti-NYEr"></textarea>
        <div style="height:10px"></div>
        <div class="row">
          <label class="opt"><input type="checkbox" id="autoMode" checked> è‡ªåŠ¨åˆ†ç¦»ï¼ˆæ™ºèƒ½æŠ½å–ï¼‰</label>
          <div class="opt" style="flex:.9">
            <span class="small">è‡ªå®šä¹‰åˆ†éš”ç¬¦</span>
            <input type="text" id="splitter" placeholder="å¦‚ï¼š, æˆ– | æˆ– ç©ºæ ¼" />
          </div>
        </div>
        <div style="height:10px"></div>
        <div class="row">
          <button class="btn btn-primary" id="btnParse">è§£æ / æ›´æ–°</button>
          <button class="btn btn-secondary" id="btnBuildLink">ç”Ÿæˆå¯åˆ†äº«é“¾æ¥</button>
        </div>
        <div id="buildLinkResult" class="hint" style="margin-top:8px;word-break:break-all;"></div>
      </div>

      <div class="section">
        <div class="label">å®Œæ•´å†…å®¹</div>
        <div class="display-box" id="fullContent">-</div>
        <div style="height:10px"></div>
        <div class="row">
          <button class="btn btn-primary" id="btnCopyAll">å¤åˆ¶å®Œæ•´å†…å®¹</button>
          <button class="btn btn-secondary" id="btnCopySelected" disabled>å¤åˆ¶é€‰ä¸­ï¼ˆ0ï¼‰</button>
        </div>
        <div id="status" class="status"></div>
      </div>
    </div>

    <!-- å³ä¾§ï¼šæŠ½å–çš„ç‰‡æ®µ -->
    <div class="right">
      <div class="section">
        <div class="label">è‡ªåŠ¨æŠ½å– / åˆ†æ®µç»“æœï¼ˆç‚¹å‡»ä»»æ„ä¸€é¡¹å³å¯å¤åˆ¶ï¼‰</div>
        <div id="parts" class="parts"></div>
        <div class="divider"></div>
        <label class="opt small"><input type="checkbox" id="multiSelect"> å¤šé€‰æ¨¡å¼</label>
        <div class="hint" style="margin-top:8px">è¯†åˆ«ç±»å‹ï¼šå–ä»¶ç ã€å°¾å·ã€ç”µè¯ï¼ˆæ‰‹æœº/åº§æœºï¼‰ã€ç½‘å€ã€åœ°å€ã€åœ°ç‚¹æè¿°ï¼ˆå«â€œæŸœ/æ¥¼/åº§â€ï¼‰ã€ä¸­æ‹¬å·æ ‡ç­¾ç­‰</div>
      </div>

      <div class="section">
        <div class="label">URL å‚æ•°ç”¨æ³•</div>
        <div class="hint">
          â€¢ åŸºç¡€å¤åˆ¶ï¼š<code>?code=å†…å®¹</code><br />
          â€¢ æ™ºèƒ½æ‹†åˆ†ï¼š<code>?text=å†…å®¹&mode=auto</code><br />
          â€¢ è‡ªå®šä¹‰åˆ†éš”ï¼š<code>?text=å†…å®¹&split=,</code><br />
          â€¢ å¤šä¸ªå€¼ï¼š<code>?values=å€¼1,å€¼2,å€¼3</code>
        </div>
      </div>
    </div>
  </div>

  <script>
    /******************** å·¥å…·å‡½æ•° ********************/
    const $ = (id) => document.getElementById(id);
    const statusEl = $('status');

    const showStatus = (msg, ok=true) => {
      statusEl.textContent = msg;
      statusEl.className = 'status show ' + (ok ? 'ok' : 'err');
      clearTimeout(showStatus._t);
      showStatus._t = setTimeout(()=>{ statusEl.className = 'status'; }, 2800);
    };

    async function copyText(text, msg='å·²å¤åˆ¶') {
      try {
        await navigator.clipboard.writeText(text);
        showStatus(msg, true);
      } catch {
        const ta = document.createElement('textarea');
        ta.value = text; ta.style.position='fixed'; ta.style.left='-9999px';
        document.body.appendChild(ta); ta.select();
        try { document.execCommand('copy'); showStatus(msg, true); }
        catch { showStatus('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', false); }
        document.body.removeChild(ta);
      }
    }

    const sanitize = (s='') => s
      .replace(/[\u200B-\u200D\uFEFF]/g,'') // é›¶å®½å­—ç¬¦
      .replace(/[\s\t\xA0]+/g,' ') // å¼‚å¸¸ç©ºæ ¼
      .replace(/\s*([ï¼Œã€‚ï¼›,;])\s*/g,'$1'); // ä¸­è‹±æ–‡æ ‡ç‚¹ä¸¤ä¾§ç©ºæ ¼

    const uniq = (arr) => Array.from(new Set(arr.filter(Boolean)));

    /******************** æŠ½å–è§„åˆ™ ********************/
    function extractAll(raw) {
      const text = sanitize(raw);
      const parts = [];

      // 1) å–ä»¶ç ï¼ˆæ˜¾å¼â€œå–ä»¶ç â€ï¼‰ï¼Œæ”¯æŒå‰ç¼€å­—æ¯ï¼šS0246ã€JD1234 ç­‰
      const codeExp = /å–ä»¶ç \s*[:ï¼š]?\s*([A-Z]{1,2}?\d{3,8}|\d{4,8})/gi;
      let m; while ((m = codeExp.exec(text))) {
        parts.push({ key:'å–ä»¶ç ', val:m[1], type:'code' });
      }

      // 2) å°¾å·
      const tailExp = /å°¾å·\s*(\d{2,4})/g; let t;
      while ((t = tailExp.exec(text))) parts.push({ key:'å°¾å·', val:t[1], type:'tail' });

      // 3) æ‰‹æœºå·ï¼ˆä¸­å›½å¤§é™†ï¼‰ & åº§æœº
      const mobile = text.match(/(?<!\d)(1[3-9]\d{9})(?!\d)/g);
      if (mobile) mobile.forEach(v=>parts.push({ key:'ç”µè¯', val:v, type:'phone' }));
      const landline = text.match(/(?<!\d)(0\d{2,3}-?\d{7,8})(?!\d)/g);
      if (landline) landline.forEach(v=>parts.push({ key:'åº§æœº', val:v, type:'phone' }));

      // 4) URL
      const urls = text.match(/https?:\/\/[^\sï¼Œã€‚ï¼›ã€)ï¼‰]+/g);
      if (urls) urls.forEach(v=>parts.push({ key:'é“¾æ¥', val:v, type:'url' }));

      // 5) åœ°å€ï¼ˆå°½é‡ä»â€œåœ°å€ï¼šâ€å¼€å§‹åˆ°ç”µè¯/é“¾æ¥/å¥æœ«ï¼‰
      const addrExp = /(åœ°å€|å–ä»¶åœ°å€)\s*[:ï¼š]\s*([\s\S]*?)(?=è”ç³»ç”µè¯|è”ç³»ç”µè¯:|ç”µè¯|é“¾æ¥|https?:\/\/|å–ä»¶|å¯„ä»¶|$)/g;
      let a; while ((a = addrExp.exec(text))) {
        const val = a[2].replace(/[ï¼Œã€‚ï¼›;]*$/,'').trim();
        if (val) parts.push({ key:'åœ°å€', val, type:'address' });
      }

      // 6) ä¸­æ‹¬å·æ ‡ç­¾
      const tags = text.match(/ã€([^ã€‘]+)ã€‘/g);
      if (tags) tags.forEach((it)=>{
        const val = it.replace(/ã€|ã€‘/g,'');
        parts.push({ key:'æ ‡ç­¾', val, type:'tag' });
      });

      // 7) åœ°ç‚¹æè¿°ï¼ˆå« æŸœ/æ¥¼/åº§ ç­‰å…³é”®è¯ï¼Œä¸”æºå¸¦æ ¼ä½å¦‚ A16 / G20 / 11å·æŸœï¼‰
      const locs = text.match(/[\u4e00-\u9fa5A-Z0-9\- ]{0,20}(?:æ–°ä¸»æ¥¼|æ–°åŒ—|æœåŠ¡ç«™|å¿«é€’æŸœ|[ä¸œå—è¥¿åŒ—]ä¾§)?[\u4e00-\u9fa5]*?(?:æŸœ|æ¥¼|åº§)[\u4e00-\u9fa5 ]*([A-Z]?\d{1,3}|\d+å·æŸœ)/g);
      if (locs) locs.forEach(v=>parts.push({ key:'åœ°ç‚¹', val:v.trim(), type:'location' }));

      // 8) çº¯æ•°å­—ä¸²ï¼ˆ>=6ï¼‰ï¼Œé¿å…æŠŠæ‰‹æœºå·/å°¾å·é‡å¤åŠ å…¥
      const taken = new Set(parts.filter(p=>p.type==='phone' || p.type==='tail').map(p=>p.val));
      const nums = text.match(/\b\d{6,}\b/g);
      if (nums) nums.forEach(v=>{ if(!taken.has(v)) parts.push({ key:'æ•°å­—', val:v, type:'number' }); });

      // å»é‡ï¼ˆæŒ‰ key+valï¼‰
      const seen = new Set();
      const out = [];
      for (const p of parts){
        const k = p.key + '|' + p.val;
        if (!seen.has(k)){ seen.add(k); out.push(p); }
      }
      return out;
    }

    /******************** æ¸²æŸ“ ********************/
    let extracted = [];
    const selectedIdx = new Set();

    function renderParts(list){
      const wrap = $('parts');
      wrap.innerHTML = '';
      list.forEach((p, idx)=>{
        const item = document.createElement('div');
        item.className = 'part' + (selectedIdx.has(idx) ? ' active' : '');
        const k = document.createElement('div'); k.className = 'part-k'; k.textContent = p.key;
        const v = document.createElement('div'); v.className = 'part-v'; v.textContent = p.val;
        item.appendChild(k); item.appendChild(v);
        item.addEventListener('click', ()=> onPartClick(idx));
        wrap.appendChild(item);
      });
      updateSelectedBtn();
    }

    function onPartClick(idx){
      if (!$('multiSelect').checked){
        copyText(extracted[idx].val, `å·²å¤åˆ¶ï¼š${extracted[idx].val}`);
        return;
      }
      if (selectedIdx.has(idx)) selectedIdx.delete(idx); else selectedIdx.add(idx);
      renderParts(extracted);
    }

    function updateSelectedBtn(){
      const btn = $('btnCopySelected');
      const n = selectedIdx.size;
      btn.textContent = `å¤åˆ¶é€‰ä¸­ï¼ˆ${n}ï¼‰`;
      btn.disabled = n===0;
    }

    function setFullContent(text){
      $('fullContent').textContent = text || '-';
    }

    /******************** URL å‚æ•° & è§£æ ********************/
    function getParams(){
      const sp = new URLSearchParams(location.search);
      return {
        code: sp.get('code'),
        text: sp.get('text'),
        mode: sp.get('mode'),
        split: sp.get('split'),
        values: sp.get('values'),
        title: sp.get('title')
      };
    }

    async function applyParams(){
      const p = getParams();
      if (p.title) $('title').textContent = decodeURIComponent(p.title);

      if (p.code){
        const v = p.code; setFullContent(v); await copyText(v, 'å·²è‡ªåŠ¨å¤åˆ¶å†…å®¹');
        $('input').value = v;
        extracted = extractAll(v); renderParts(extracted);
        return;
      }

      if (p.values){
        const arr = p.values.split(',').map(s=>s.trim()).filter(Boolean);
        setFullContent(arr.join('\n'));
        $('input').value = arr.join(' , ');
        extracted = arr.map((v,i)=>({key:`é¡¹ç›®${i+1}`, val:v, type:'item'}));
        renderParts(extracted);
        return;
      }

      if (p.text){
        const t = decodeURIComponent(p.text);
        setFullContent(t); $('input').value = t;
        if (p.mode === 'auto'){
          extracted = extractAll(t); renderParts(extracted);
        }
        if (p.split){
          const segs = t.split(p.split).map(s=>s.trim()).filter(Boolean);
          extracted = segs.map((v,i)=>({key:`éƒ¨åˆ†${i+1}`, val:v, type:'part'}));
          renderParts(extracted);
        }
        return;
      }

      // æ— å‚æ•°ï¼šç©ºæ€
      setFullContent('ï¼ˆç­‰å¾…è¾“å…¥â€¦ï¼‰');
    }

    /******************** äº‹ä»¶ç»‘å®š ********************/
    $('btnCopyAll').addEventListener('click', ()=> copyText($('fullContent').textContent,'å·²å¤åˆ¶å®Œæ•´å†…å®¹'));
    $('btnCopySelected').addEventListener('click', ()=>{
      const lines = [...selectedIdx].sort((a,b)=>a-b).map(i=>extracted[i].val).join('\n');
      copyText(lines, `å·²å¤åˆ¶ ${selectedIdx.size} é¡¹`);
    });

    $('btnParse').addEventListener('click', ()=>{
      const raw = $('input').value || '';
      setFullContent(raw);
      selectedIdx.clear();
      const split = $('splitter').value;
      if (split){
        const segs = raw.split(split).map(s=>s.trim()).filter(Boolean);
        extracted = segs.map((v,i)=>({key:`éƒ¨åˆ†${i+1}`, val:v, type:'part'}));
      } else if ($('autoMode').checked){
        extracted = extractAll(raw);
      } else {
        extracted = [];
      }
      renderParts(extracted);
      showStatus('è§£æå®Œæˆ', true);
    });

    $('btnBuildLink').addEventListener('click', ()=>{
      const raw = $('input').value || '';
      const base = location.origin + location.pathname;
      let url = base;
      if ($('splitter').value){
        url += `?text=${encodeURIComponent(raw)}&split=${encodeURIComponent($('splitter').value)}`;
      } else if ($('autoMode').checked){
        url += `?text=${encodeURIComponent(raw)}&mode=auto`;
      } else {
        url += `?code=${encodeURIComponent(raw)}`;
      }
      $('buildLinkResult').innerHTML = `ğŸ‘‰ å¤åˆ¶å¹¶åˆ†äº«ï¼š<a href="${url}">${url}</a>`;
      copyText(url, 'å·²å¤åˆ¶ç”Ÿæˆçš„é“¾æ¥');
    });

    $('multiSelect').addEventListener('change', ()=>{ selectedIdx.clear(); renderParts(extracted); });

    window.addEventListener('load', applyParams);
  </script>
</body>
</html>
