<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¿«é€Ÿå¤åˆ¶ Â· åŒç•Œé¢ & æ›´æ™ºèƒ½</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{--bg:#f7f7f5;--fg:#37352f;--muted:#787774;--line:#e3e2e0;--card:#fff;--accent:#0f7b6c}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Noto Sans',sans-serif;background:var(--bg);color:var(--fg);min-height:100vh}
    .wrap{max-width:860px;margin:0 auto;padding:18px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;box-shadow:0 1px 3px rgba(0,0,0,.05),0 10px 40px rgba(0,0,0,.08);padding:18px}
    .header{display:flex;align-items:center;gap:10px;margin-bottom:10px}
    .icon{font-size:24px}
    h1{font-size:20px;font-weight:800}
    .muted{color:var(--muted)}
    .section{background:var(--bg);border:1px solid var(--line);border-radius:12px;padding:12px;margin-top:12px}
    textarea,input[type=text]{width:100%;border:1px solid var(--line);background:#fff;border-radius:10px;padding:10px 12px;font:inherit;color:var(--fg)}
    .row{display:flex;gap:10px;align-items:center}.row>*{flex:1}
    .btn{border:none;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
    .btn-primary{background:var(--fg);color:#fff}.btn-secondary{background:#fff;color:var(--fg);border:1px solid var(--line)}
    .status{display:none;margin-top:8px;padding:10px;border-radius:10px;font-size:14px}
    .status.show{display:block}.status.ok{background:#edf3ec;color:#0f7b6c}.status.err{background:#fdebec;color:#e03e3e}
    .grid{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:760px){.grid{grid-template-columns:1fr 1fr}}
    .display{white-space:pre-wrap;word-break:break-word;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
    .pill{display:inline-block;background:#fff;border:1px solid var(--line);padding:2px 8px;border-radius:999px;font-size:12px;margin-right:6px}
    .parts{display:flex;flex-direction:column;gap:8px}
    .part{display:flex;gap:10px;align-items:center;background:#fff;border:1px solid var(--line);border-radius:10px;padding:10px;cursor:pointer}
    .part:hover{background:#f0f0ee}.part.active{background:#e3f2fd;border-color:#90caf9}
    .k{min-width:80px;font-size:12px;color:var(--muted)}.v{flex:1;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap}
    .topbar{position:sticky;top:0;z-index:10;background:var(--bg);padding:8px 0;margin:-8px 0 8px}
    .link{word-break:break-all}.back{display:inline-flex;align-items:center;gap:6px}
  </style>
</head>
<body>
  <div class="wrap">
    <!-- è§†å›¾ Aï¼šè¾“å…¥é¡µ -->
    <div id="view-input" class="card" role="region" aria-labelledby="titleA">
      <div class="header"><div class="icon">âœ‚ï¸</div><h1 id="titleA">å¿«é€Ÿå¤åˆ¶ï¼ˆè¾“å…¥ï¼‰</h1></div>
      <p class="muted">åœ¨æ­¤ç²˜è´´çŸ­ä¿¡æˆ–æ–‡æœ¬ï¼›å¯é€‰æ‹©â€œè‡ªåŠ¨åˆ†ç¦»â€æˆ–è‡ªå®šä¹‰åˆ†éš”ç¬¦ã€‚ç‚¹â€œè§£æâ€åè¿›å…¥ç»“æœé¡µã€‚</p>

      <div class="section">
        <div class="row">
          <label class="row" style="align-items:flex-start;gap:10px">
            <span class="muted" style="flex:0 0 96px">è¾“å…¥æ–‡æœ¬</span>
            <textarea id="ta" rows="7" placeholder="ç²˜è´´åˆ°è¿™é‡Œï¼Œä¾‹å¦‚ï¼š
ã€äº¬ä¸œå¿«é€’ã€‘å–ä»¶ç S0246â€¦ è”ç³»ç”µè¯ 18210824625 â€¦ https://3.cn/â€¦ åœ°å€ï¼šâ€¦
æˆ–ï¼š
ã€é©¿å°å“¥ã€‘â€¦è¯·20:00å‰å‡­B-2191æ¥å–â€¦"></textarea>
          </label>
        </div>
        <div class="row" style="margin-top:10px">
          <label class="row" style="flex:1"><span class="muted" style="flex:0 0 96px">åˆ†éš”ç¬¦</span><input id="splitter" type="text" placeholder=", æˆ– | æˆ– ç©ºæ ¼"/></label>
        </div>
        <div class="row" style="margin-top:6px">
          <label style="display:flex;align-items:center;gap:8px"><input id="auto" type="checkbox" checked/> è‡ªåŠ¨åˆ†ç¦»</label>
          <span class="muted" style="font-size:12px">è‹¥å¡«å†™åˆ†éš”ç¬¦ï¼Œåˆ™ä¼˜å…ˆæŒ‰åˆ†éš”ç¬¦åˆ‡åˆ†</span>
        </div>
        <div class="toolbar" style="margin-top:10px">
          <button id="btnParseGo" class="btn btn-primary">è§£æå¹¶æŸ¥çœ‹ç»“æœ â†’</button>
          <button id="btnBuild" class="btn btn-secondary">ç”Ÿæˆå¯åˆ†äº«é“¾æ¥</button>
          <span id="built" class="muted link"></span>
        </div>
        <div id="stA" class="status"></div>
      </div>

      <div class="section">
        <div class="muted" style="margin-bottom:6px">URL å‚æ•°é€Ÿè®°</div>
        <div class="display">
          â€¢ <span class="pill">ç›´æ¥å¤åˆ¶</span><code>?code=å†…å®¹</code><br>
          â€¢ <span class="pill">æ™ºèƒ½æ‹†åˆ†</span><code>?text=å†…å®¹&mode=auto</code><br>
          â€¢ <span class="pill">åˆ†éš”ç¬¦</span><code>?text=å†…å®¹&split=,</code><br>
          â€¢ <span class="pill">å¤šå€¼</span><code>?values=å€¼1,å€¼2</code>
        </div>
      </div>
    </div>

    <!-- è§†å›¾ Bï¼šç»“æœé¡µ -->
    <div id="view-result" class="card" role="region" aria-labelledby="titleB" style="display:none">
      <div class="topbar"><button id="backBtn" class="btn btn-secondary back">â† è¿”å›</button></div>
      <div class="header"><div class="icon">ğŸ“‹</div><h1 id="titleB">å¿«é€Ÿå¤åˆ¶ï¼ˆç»“æœï¼‰</h1></div>
      <p class="muted">ç‚¹å‡»ä»»æ„æ¡ç›®ç›´æ¥å¤åˆ¶ï¼›æ”¯æŒå¤šé€‰å¤åˆ¶ã€‚</p>

      <div class="grid">
        <div class="section">
          <div class="muted" style="margin-bottom:6px">å®Œæ•´å†…å®¹</div>
          <div id="full" class="display section" style="background:#fff"></div>
          <div class="toolbar" style="margin-top:10px">
            <button id="copyFull" class="btn btn-primary">å¤åˆ¶å®Œæ•´å†…å®¹</button>
            <button id="copySel" class="btn btn-secondary" disabled>å¤åˆ¶é€‰ä¸­ï¼ˆ0ï¼‰</button>
          </div>
          <div id="stB" class="status"></div>
        </div>
        <div class="section">
          <div class="muted" style="margin-bottom:6px">æŠ½å–ç»“æœ</div>
          <div id="parts" class="parts"></div>
          <div class="toolbar" style="margin-top:8px">
            <label style="display:flex;align-items:center;gap:8px"><input id="multi" type="checkbox"/> å¤šé€‰æ¨¡å¼</label>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    /******** è·¯ç”±ä¸çŠ¶æ€ ********/
    const S = { text:'', auto:true, splitter:'', extracted:[], selected:new Set() };
    const qs = (id)=>document.getElementById(id);
    function go(view){
      const A = qs('view-input'), B = qs('view-result');
      if(view==='B'){ A.style.display='none'; B.style.display='block'; history.pushState({v:'B'},'','#result'); }
      else { A.style.display='block'; B.style.display='none'; history.pushState({v:'A'},'','#'); }
    }
    window.onpopstate = (e)=>{ const v = (e.state && e.state.v)|| (location.hash==='#result'?'B':'A'); go(v); };

    /******** å·¥å…·å‡½æ•° ********/
    const showSt = (el,msg,ok=true)=>{ el.textContent=msg; el.className='status show '+(ok?'ok':'err'); clearTimeout(el._t); el._t=setTimeout(()=>{el.className='status'},2500); };
    async function copyText(s){ try{ await navigator.clipboard.writeText(s); }catch{ const ta=document.createElement('textarea'); ta.value=s; ta.style.position='fixed'; ta.style.left='-9999px'; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove(); } }

    // è§„èŒƒåŒ–ï¼šå»é›¶å®½ï¼›åˆå¹¶æ¢è¡Œå’Œå¤šç©ºæ ¼ï¼›æ¶ˆé™¤è¢«çŸ­ä¿¡æ’å…¥çš„â€œä¸­é—´ç©ºæ ¼â€ï¼ˆæ ¡ å†…â†’æ ¡å†…ï¼›åŒ— èˆªâ†’åŒ—èˆªï¼‰
    function normalize(raw=''){
      return raw
        .replace(/[\u200B-\u200D\uFEFF]/g,'')
        .replace(/[\r\n]+/g,' ')
        .replace(/\s+/g,' ')
        .replace(/([\u4e00-\u9fa5])\s+([\u4e00-\u9fa5])/g,'$1$2')
        .replace(/([\u4e00-\u9fa5])\s+([A-Za-z0-9])/g,'$1$2')
        .replace(/([A-Za-z0-9])\s+([\u4e00-\u9fa5])/g,'$1$2')
        .trim();
    }
    const uniq = (arr)=>Array.from(new Set(arr.filter(Boolean)));

    /******** æ›´æ™ºèƒ½çš„æŠ½å– ********/
    function extractAll(raw){
      const text = normalize(raw);
      const parts = [];

      // æ ‡ç­¾ï¼ˆã€ã€‘ï¼‰
      const tags = text.match(/ã€([^ã€‘]+)ã€‘/g);
      if(tags){ for(const t of tags){ parts.push({key:'æ ‡ç­¾', val:t.replace(/ã€|ã€‘/g,''), type:'tag'}); } }

      // å–ä»¶/å‡­ç ï¼šå¤šç§å†™æ³•ï¼ˆå«å­—æ¯-æ•°å­—ï¼Œå¦‚ B-2191ï¼‰
      const codeByWord = /(å–ä»¶ç |å–è´§ç |æè´§ç |å–ä»¶å·|å–è´§å·|éªŒè¯ç |æ ¸éªŒç |å‡­ç |å‡­)\s*[:ï¼š]?\s*([A-Z]{1,3}-?\d{3,6}|\d{4,8})/gi;
      let m; while((m=codeByWord.exec(text))) parts.push({key:'å–ä»¶ç ', val:m[2], type:'code'});

      // é€šç”¨ç ï¼šA1234 / B-2191 / S0246ï¼ˆé¿å…æŠŠæ—¶é—´ 20:00 è¯†åˆ«æˆç ï¼‰
      const codeGeneric = /(?<![A-Z0-9])([A-Z]{1,3}-?\d{3,6})(?![A-Z0-9:])/g;
      let g; while((g=codeGeneric.exec(text))) parts.push({key:'å¯èƒ½çš„å–ä»¶ç ', val:g[1], type:'code2'});

      // å°¾å·
      const tail = /å°¾å·\s*(\d{2,4})/g; let t;
      while((t=tail.exec(text))) parts.push({key:'å°¾å·', val:t[1], type:'tail'});

      // æ—¶é—´ï¼ˆHH:MM æˆ– â€œ20ç‚¹/20ç‚¹å‰â€ï¼‰
      const times = uniq((text.match(/\b(\d{1,2}:\d{2})\b/g)||[]).concat(text.match(/(\d{1,2})ç‚¹(?:å‰)?/g)||[]));
      times.forEach(v=>parts.push({key:'æ—¶é—´', val:v, type:'time'}));

      // æ‰‹æœºå·/åº§æœº
      (text.match(/(?<!\d)(1[3-9]\d{9})(?!\d)/g)||[]).forEach(v=>parts.push({key:'ç”µè¯', val:v, type:'phone'}));
      (text.match(/(?<!\d)(0\d{2,3}-?\d{7,8})(?!\d)/g)||[]).forEach(v=>parts.push({key:'åº§æœº', val:v, type:'phone'}));

      // URL
      (text.match(/https?:\/\/[^\sï¼Œã€‚ï¼›ã€)ï¼‰]+/g)||[]).forEach(v=>parts.push({key:'é“¾æ¥', val:v, type:'url'}));

      // åœ°å€ï¼ˆâ€œåœ°å€ï¼šâ€å¼€å¤´ï¼‰
      const addrRe = /(åœ°å€|å–ä»¶åœ°å€)\s*[:ï¼š]\s*([\s\S]*?)(?=è”ç³»ç”µè¯|ç”µè¯|é“¾æ¥|https?:\/\/|å–ä»¶|å¯„ä»¶|è¯·|è°¢è°¢|$)/g;
      let a; while((a=addrRe.exec(text))){ const v=a[2].replace(/[ï¼Œã€‚ï¼›;]*$/,'').trim(); if(v) parts.push({key:'åœ°å€', val:v, type:'address'}); }

      // åœ°ç‚¹ç‰‡æ®µï¼šå›´ç»•å…³é”®è¯æˆªä¸€æ®µï¼ˆè¿‘é‚»å®/å¿«é€’æŸœ/é©¿ç«™/æœåŠ¡ç«™/æ ¡å†…/æ ¡åŒº/æ–°ä¸»æ¥¼/ABCDåº§/ä¸œè¥¿å—åŒ—ä¾§ï¼‰
      const locKey = /(è¿‘é‚»å®|ä¸°å·¢|å¿«é€’æŸœ|é©¿ç«™|æœåŠ¡ç«™|æ ¡å›­æœåŠ¡ç«™|æ ¡å†…|æ ¡åŒº|[æ–°æ—§]ä¸»æ¥¼|[ABCD]åº§|[ä¸œå—è¥¿åŒ—]ä¾§)/;
      if(locKey.test(text)){
        const idx = text.search(locKey);
        const start = Math.max(0, idx-20), end = Math.min(text.length, idx+40);
        const snippet = text.substring(start,end).replace(/[ã€‚ï¼›;,.]/g,'').trim();
        if(snippet) parts.push({key:'åœ°ç‚¹', val:snippet, type:'location'});
      }

      // çº¯æ•°å­—ï¼ˆ>=6ï¼‰ï¼Œé¿å¼€ç”µè¯/å°¾å·
      const taken = new Set(parts.filter(p=>p.type==='phone'||p.type==='tail').map(p=>p.val));
      (text.match(/\b\d{6,}\b/g)||[]).forEach(v=>{ if(!taken.has(v)) parts.push({key:'æ•°å­—', val:v, type:'number'}); });

      // å»é‡
      const out=[]; const seen=new Set();
      for(const p of parts){ const k=p.key+'|'+p.val; if(!seen.has(k)){ seen.add(k); out.push(p); } }
      return out;
    }

    /******** æ¸²æŸ“ ********/
    function render(){
      qs('full').textContent = S.text || 'ï¼ˆç©ºï¼‰';
      const partsWrap = qs('parts'); partsWrap.innerHTML='';
      S.extracted.forEach((p,i)=>{
        const d=document.createElement('div'); d.className='part'+(S.selected.has(i)?' active':'');
        const k=document.createElement('div'); k.className='k'; k.textContent=p.key;
        const v=document.createElement('div'); v.className='v'; v.textContent=p.val;
        d.appendChild(k); d.appendChild(v);
        d.addEventListener('click',()=>{
          if(!qs('multi').checked){
            copyText(p.val).then(()=>{ const st=qs('stB'); showSt(st,`å·²å¤åˆ¶ï¼š${p.val}`,true); });
          }else{
            S.selected.has(i)?S.selected.delete(i):S.selected.add(i); render();
          }
        });
        partsWrap.appendChild(d);
      });
      const n=S.selected.size; const btn=qs('copySel'); btn.textContent=`å¤åˆ¶é€‰ä¸­ï¼ˆ${n})`; btn.disabled=!n;
    }

    /******** äº¤äº’ ********/
    qs('btnParseGo').addEventListener('click',()=>{
      S.text = qs('ta').value||''; S.auto = qs('auto').checked; S.splitter = qs('splitter').value||''; S.selected.clear();
      if(S.splitter){
        S.extracted = S.text.split(S.splitter).map(s=>s.trim()).filter(Boolean).map((v,i)=>({key:`éƒ¨åˆ†${i+1}`,val:v}));
      }else if(S.auto){
        S.extracted = extractAll(S.text);
      }else{
        S.extracted = [];
      }
      go('B'); render();
    });
    qs('copyFull').addEventListener('click',()=>{ copyText(qs('full').textContent).then(()=>showSt(qs('stB'),'å·²å¤åˆ¶å®Œæ•´å†…å®¹',true)); });
    qs('copySel').addEventListener('click',()=>{ const lines=[...S.selected].sort((a,b)=>a-b).map(i=>S.extracted[i].val).join('\n'); copyText(lines).then(()=>showSt(qs('stB'),`å·²å¤åˆ¶ ${S.selected.size} é¡¹`,true)); });
    qs('multi').addEventListener('change',()=>{ S.selected.clear(); render(); });

    qs('btnBuild').addEventListener('click',()=>{
      const base = location.origin + location.pathname;
      const raw = qs('ta').value||''; const split = qs('splitter').value||''; const auto = qs('auto').checked;
      let url = base;
      if(split){ url += `?text=${encodeURIComponent(raw)}&split=${encodeURIComponent(split)}`; }
      else if(auto){ url += `?text=${encodeURIComponent(raw)}&mode=auto`; }
      else { url += `?code=${encodeURIComponent(raw)}`; }
      qs('built').innerHTML = `å·²ç”Ÿæˆï¼š<a href="${url}">${url}</a>`;
      copyText(url); showSt(qs('stA'),'é“¾æ¥å·²å¤åˆ¶',true);
    });

    // URL ç›´æ¥è¿›ç»“æœé¡µ
    function applyParams(){
      const sp=new URLSearchParams(location.search);
      const code=sp.get('code'); const text=sp.get('text'); const values=sp.get('values'); const mode=sp.get('mode'); const split=sp.get('split');
      if(code){ S.text=code; S.extracted=extractAll(code); go('B'); render(); copyText(code).then(()=>showSt(qs('stB'),'å·²è‡ªåŠ¨å¤åˆ¶å†…å®¹',true)); return; }
      if(values){ const arr=values.split(',').map(s=>s.trim()).filter(Boolean); S.text=arr.join('\n'); S.extracted=arr.map((v,i)=>({key:`é¡¹ç›®${i+1}`,val:v})); go('B'); render(); return; }
      if(text){ const t=decodeURIComponent(text); S.text=t; if(split){ S.extracted=t.split(split).map(s=>s.trim()).filter(Boolean).map((v,i)=>({key:`éƒ¨åˆ†${i+1}`,val:v})); } else if(mode==='auto'){ S.extracted=extractAll(t); } go('B'); render(); return; }
      go('A');
    }
    qs('backBtn').addEventListener('click',()=>go('A'));
    window.addEventListener('load', applyParams);
  </script>
</body>
</html>
